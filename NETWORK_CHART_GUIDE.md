# 업체 관계도 네트워크 차트 가이드 🕸️

## 개요
업체 관계도는 D3.js를 기반으로 한 인터랙티브 네트워크 차트로, 업체 간의 복잡한 관계를 시각적으로 표현하고 관리할 수 있는 기능입니다.

## 🎯 주요 기능

### 📊 네트워크 시각화
- **중심 업체**: 선택한 업체를 중심으로 관계도 생성
- **관계선**: 화살표가 있는 방향성 관계 표시
- **색상 코딩**: 등록된 업체 vs 임시 업체 구분
- **실시간 레이아웃**: 드래그 앤 드롭으로 노드 위치 조정

### 🔍 업체 검색 및 추가
- **자동 완성**: 등록된 업체 목록에서 검색
- **직접 입력**: 임시 업체 추가 가능
- **색상 매칭**: 기존 업체의 설정된 색상 자동 적용

### 🔗 관계 설정
- **관계 유형**: 납품, 매입, 자회사, 모회사, 협력사, 경쟁사 등
- **양방향 관계**: 시작점과 종료점 설정
- **레이블 표시**: 관계 유형이 화살표에 표시

## 🎮 사용 방법

### 기본 조작
1. **노드 드래그**: 마우스로 업체 위치 이동 (부드러운 드래그)
2. **줌/팬**: 마우스 휠로 확대/축소, 드래그로 화면 이동
3. **노드 클릭**: 관계 설정을 위한 업체 선택 (드롭다운 자동 설정)
4. **더블클릭**: 등록된 업체를 중심으로 새 관계도 이동

### 업체 추가
```
1. 컨트롤 패널 > "업체명 검색 또는 직접 입력"
2. 검색 결과에서 선택하거나 직접 입력
3. 자동으로 네트워크에 노드 추가
4. 드롭다운 목록에 자동 반영
```

### 관계 설정 (개선된 UI)
```
1. 시작 업체 노드 클릭 → 드롭다운에 자동 설정
2. 대상 업체 노드 클릭 → 드롭다운에 자동 설정
3. 또는 드롭다운에서 직접 선택
4. 관계 유형 선택 (납품, 매입, 자회사 등)
5. "관계 추가" 버튼 클릭
```

## 🎨 시각적 요소

### 색상 체계
- **🔴 빨간색**: 중심 업체 (고정)
- **🔵 파란색**: 등록된 업체 (데이터베이스에 존재)
- **⚪ 회색**: 임시 업체 (관계도에서만 존재)
- **사용자 정의**: 설정에서 지정한 업체 색상

### 노드 크기
- **Large (40px)**: 중심 업체
- **Medium (30px)**: 일반 업체
- **Small (20px)**: 보조 업체

### 관계선
- **실선 화살표**: 방향성 있는 관계
- **곡선**: 겹치지 않는 자연스러운 경로
- **레이블**: 관계 유형 텍스트 표시

## 💾 데이터 관리

### 저장 구조
```json
{
  "center_company_id": 327,
  "center_company_name": "위더스 레이저",
  "nodes": [
    {
      "id": "company_327",
      "name": "위더스 레이저",
      "type": "center",
      "color": "#e74c3c",
      "isRegistered": true
    }
  ],
  "links": [
    {
      "source": "company_327",
      "target": "temp_123",
      "type": "납품",
      "label": "납품"
    }
  ]
}
```

### 데이터베이스 테이블
- **company_networks**: 네트워크 메타데이터
- **company_relationships**: 개별 관계 정보 (향후 확장용)

## 🛠️ 기술적 구현

### 핵심 라이브러리
- **D3.js v7**: 데이터 시각화 및 DOM 조작
- **Force Simulation**: 물리 기반 자동 배치 (반응형 최적화)
- **SVG**: 벡터 그래픽 렌더링

### 주요 컴포넌트 (반응형 적용)
```javascript
// 화면 크기에 따른 시뮬레이션 조정
const isMobile = width < 768;
const linkDistance = isMobile ? 150 : 250;  // PC에서 더 큰 간격
const chargeStrength = isMobile ? -300 : -500;  // PC에서 더 강한 반발력
const collisionRadius = isMobile ? 60 : 90;  // PC에서 더 큰 충돌 반경

simulation = d3.forceSimulation()
    .force('link', d3.forceLink().distance(linkDistance))
    .force('charge', d3.forceManyBody().strength(chargeStrength))
    .force('center', d3.forceCenter(width/2, height/2))
    .force('collision', d3.forceCollide().radius(collisionRadius));
```

### 이벤트 처리
- **드래그**: D3 drag behavior
- **줌**: D3 zoom behavior
- **클릭**: 커스텀 노드 선택 로직
- **업데이트**: 실시간 차트 재렌더링

## 🔧 컨트롤 기능

### 메인 컨트롤
- **저장**: 현재 네트워크를 데이터베이스에 저장
- **뒤로가기**: 업체 상세 페이지로 복귀

### 레이아웃 컨트롤
- **줌 리셋**: 차트를 원래 크기로 복원
- **자동 배치**: Force Simulation 재실행
- **모두 삭제**: 중심 업체 외 모든 노드 제거

### 내보내기 (예정)
- **이미지 저장**: PNG/SVG 형태로 관계도 내보내기

## 📱 반응형 지원

### 모바일 최적화
- **터치 지원**: 터치 이벤트로 드래그/줌 조작
- **레이아웃 조정**: 작은 화면에서 컨트롤 패널 재배치
- **버튼 크기**: 터치하기 쉬운 크기로 조정

### 브라우저 호환성
- **모던 브라우저**: Chrome, Firefox, Safari, Edge
- **ES6+ 문법**: 최신 JavaScript 기능 활용
- **SVG 지원**: 모든 주요 브라우저에서 지원

## 🚨 제한사항

### 성능 제한
- **권장 노드 수**: 50개 이하
- **권장 관계 수**: 100개 이하
- **복잡도**: 과도하게 복잡한 네트워크는 성능 저하 가능

### 기능 제한
- **실시간 동기화**: 현재 수동 저장/로드만 지원
- **협업**: 다중 사용자 동시 편집 불가
- **버전 관리**: 변경 이력 추적 없음

## 🔄 향후 계획

### 단기 개선사항
- **이미지 내보내기**: PNG/SVG 다운로드 기능
- **템플릿**: 업종별 기본 관계도 템플릿
- **성능 최적화**: 대용량 네트워크 처리 개선

### 장기 로드맵
- **실시간 협업**: WebSocket 기반 다중 사용자 편집
- **3D 시각화**: Three.js를 이용한 3차원 관계도
- **AI 추천**: 머신러닝 기반 관계 추천 시스템

---
*업체 관계도 기능은 복잡한 비즈니스 네트워크를 직관적으로 이해하고 관리하기 위한 혁신적인 도구입니다.*