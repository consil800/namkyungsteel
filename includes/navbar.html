<header id="header" class="header d-flex align-items-center sticky-top">
  <div class="container-fluid container-xl position-relative d-flex align-items-center">

    <a href="index.html" class="logo d-flex align-items-center me-auto">
      <img src="logo.jpg" alt="ë‚¨ê²½ìŠ¤í‹¸ ë¡œê³ " style="height: 40px; margin-right: 10px;">
      <h1 class="sitename" id="companyNameHeader">ë‚¨ê²½ìŠ¤í‹¸(ì£¼)</h1>
    </a>

    <nav id="navmenu" class="navmenu">
      <ul>
        <li><a href="index.html">í™ˆ</a></li>
        <li class="dropdown"><a href="index.html#about"><span>íšŒì‚¬ì†Œê°œ</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
          <ul>
            <li><a href="ceo-message.html">CEO ì¸ì‚¬ë§</a></li>
            <li><a href="company-history.html">íšŒì‚¬ì—°í˜</a></li>
            <li><a href="vision-mission.html">ë¹„ì „/ë¯¸ì…˜</a></li>
            <li><a href="organization.html">ì¡°ì§ë„</a></li>
            <li><a href="location.html">ì˜¤ì‹œëŠ”ê¸¸</a></li>
            <li><a href="certificates.html">ì¸ì¦ì„œ</a></li>
          </ul>
        </li>
        <li class="dropdown"><a href="index.html#services"><span>ì œí’ˆì†Œê°œ</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
          <ul>
            <li><a href="service1-details.html">ì—´ì—°ê°•íŒ</a></li>
            <li><a href="service2-details.html">ëƒ‰ì—°ê°•íŒ</a></li>
            <li><a href="service3-details.html">íŠ¹ìˆ˜ê°•</a></li>
            <li><a href="service4-details.html">ë§ì¶¤ ê°€ê³µ</a></li>
          </ul>
        </li>
        <li class="dropdown"><a href="#"><span>ì‚¬ì—…ì˜ì—­</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
          <ul>
            <li><a href="steel-manufacturing.html">ì² ê°•ì œì¡°</a></li>
            <li><a href="processing-service.html">ê°€ê³µì„œë¹„ìŠ¤</a></li>
            <li><a href="tech-research.html">ê¸°ìˆ ì—°êµ¬</a></li>
          </ul>
        </li>
        <li class="dropdown"><a href="#"><span>ê³ ê°ì„¼í„°</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
          <ul>
            <li><a href="quote-inquiry.html">ê²¬ì ë¬¸ì˜</a></li>
            <li><a href="catalog.html">ì¹´íƒˆë¡œê·¸</a></li>
            <li><a href="faq.html">FAQ</a></li>
            <li><a href="product-inquiry.html">ì œí’ˆë¬¸ì˜</a></li>
            <li><a href="technical-support.html">ê¸°ìˆ ì§€ì›</a></li>
          </ul>
        </li>
      </ul>
      <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
    </nav>

    <!-- ë¡œê·¸ì¸ ë²„íŠ¼ -->
    <a class="login-btn" href="#" onclick="showLoginModal(); return false;" id="mainLoginBtn">
      <i class="bi bi-person-circle"></i> <span id="loginBtnText">ë¡œê·¸ì¸</span>
    </a>
    
    <!-- ë¡œê·¸ì¸ í›„ í”„ë¡œí•„ ì•„ì´ì½˜ -->
    <div class="user-profile" id="userProfile" style="display: none;">
      <div class="profile-icon" onclick="handleProfileClick()">
        <img id="profileImage" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiM2NjdlZWEiLz4KPHN2ZyB4PSIyMCIgeT0iMjQiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfkYQ8L3N2Zz4KPC9zdmc+" alt="í”„ë¡œí•„" />
        <span class="profile-name" id="profileName">ì‚¬ìš©ì</span>
      </div>
    </div>

  </div>
</header>

<!-- ê³µí†µ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ìƒíƒœ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
// ê³µí†µ ë„¤ë¹„ë°” ë¡œê·¸ì¸ ìƒíƒœ ê´€ë¦¬
(function() {
    // DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkAndUpdateNavbarLoginState, 100);
        });
    } else {
        // ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ì¦‰ì‹œ ì‹¤í–‰
        setTimeout(checkAndUpdateNavbarLoginState, 100);
    }
    
    // ì¶”ê°€ë¡œ ë” ê¸´ ì§€ì—°ìœ¼ë¡œ í•œ ë²ˆ ë” í™•ì¸ (ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ë“¤ì´ sessionStorageë¥¼ ì—…ë°ì´íŠ¸í•  ì‹œê°„ ì œê³µ)
    setTimeout(checkAndUpdateNavbarLoginState, 500);
    setTimeout(checkAndUpdateNavbarLoginState, 1000);
    
    // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° ë„¤ë¹„ë°” ì—…ë°ì´íŠ¸
    function checkAndUpdateNavbarLoginState() {
        console.log('ğŸ” ë„¤ë¹„ë°”: ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì‹œì‘');
        
        const currentUser = getCurrentUserFromSessionStorage();
        console.log('ğŸ” ë„¤ë¹„ë°”: sessionStorageì—ì„œ ê°€ì ¸ì˜¨ ì‚¬ìš©ì:', currentUser);
        
        // ë„¤ë¹„ë°” ìš”ì†Œë“¤ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
        const loginBtn = document.getElementById('mainLoginBtn');
        const userProfile = document.getElementById('userProfile');
        console.log('ğŸ” ë„¤ë¹„ë°”: ìš”ì†Œ í™•ì¸', {
            loginBtn: !!loginBtn,
            userProfile: !!userProfile,
            loginBtnDisplay: loginBtn ? loginBtn.style.display : 'not found',
            userProfileDisplay: userProfile ? userProfile.style.display : 'not found'
        });
        
        if (currentUser && currentUser.name) {
            console.log('âœ… ë„¤ë¹„ë°”: ë¡œê·¸ì¸ëœ ì‚¬ìš©ì í™•ì¸ë¨:', currentUser.name);
            updateNavbarForLoggedInUser(currentUser);
        } else {
            console.log('â„¹ï¸ ë„¤ë¹„ë°”: ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ìƒíƒœ');
            updateNavbarForLoggedOutUser();
        }
    }
    
    // sessionStorageì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    function getCurrentUserFromSessionStorage() {
        try {
            const userJson = sessionStorage.getItem('currentUser');
            if (!userJson) return null;
            
            const user = JSON.parse(userJson);
            return user;
        } catch (error) {
            console.error('âŒ ë„¤ë¹„ë°”: ì‚¬ìš©ì ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', error);
            return null;
        }
    }
    
    // ë¡œê·¸ì¸ëœ ì‚¬ìš©ììš© ë„¤ë¹„ë°” ì—…ë°ì´íŠ¸
    function updateNavbarForLoggedInUser(user) {
        console.log('ğŸ”„ ë„¤ë¹„ë°”: ë¡œê·¸ì¸ ìƒíƒœë¡œ ì—…ë°ì´íŠ¸ ì‹œì‘', user);
        
        const loginBtn = document.getElementById('mainLoginBtn');
        const userProfile = document.getElementById('userProfile');
        const profileImage = document.getElementById('profileImage');
        const profileName = document.getElementById('profileName');
        
        console.log('ğŸ”„ ë„¤ë¹„ë°”: ìš”ì†Œ ì°¾ê¸° ê²°ê³¼', {
            loginBtn: !!loginBtn,
            userProfile: !!userProfile,
            profileImage: !!profileImage,
            profileName: !!profileName
        });
        
        if (loginBtn && userProfile) {
            // ë¡œê·¸ì¸ ë²„íŠ¼ ìˆ¨ê¸°ê³  í”„ë¡œí•„ í‘œì‹œ
            loginBtn.style.display = 'none';
            userProfile.style.display = 'flex';
            
            console.log('âœ… ë„¤ë¹„ë°”: ë²„íŠ¼ í‘œì‹œ ìƒíƒœ ë³€ê²½ ì™„ë£Œ', {
                loginBtnDisplay: loginBtn.style.display,
                userProfileDisplay: userProfile.style.display
            });
            
            // í”„ë¡œí•„ ì´ë¯¸ì§€ ì„¤ì •
            if (profileImage) {
                if (user.profileImage || user.profile_image) {
                    profileImage.src = user.profileImage || user.profile_image;
                } else {
                    // ê¸°ë³¸ ì•„ë°”íƒ€ ìƒì„±
                    profileImage.src = generateNavbarDefaultAvatar(user.name || user.email || 'User');
                }
                console.log('ğŸ–¼ï¸ ë„¤ë¹„ë°”: í”„ë¡œí•„ ì´ë¯¸ì§€ ì„¤ì • ì™„ë£Œ');
            }
            
            // ì‚¬ìš©ì ì´ë¦„ ì„¤ì •
            if (profileName) {
                profileName.textContent = user.name || user.email || 'ì‚¬ìš©ì';
                console.log('ğŸ‘¤ ë„¤ë¹„ë°”: ì‚¬ìš©ì ì´ë¦„ ì„¤ì • ì™„ë£Œ:', profileName.textContent);
            }
        } else {
            console.error('âŒ ë„¤ë¹„ë°”: í•„ìˆ˜ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
        }
    }
    
    // ë¡œê·¸ì•„ì›ƒ ìƒíƒœìš© ë„¤ë¹„ë°” ì—…ë°ì´íŠ¸
    function updateNavbarForLoggedOutUser() {
        console.log('ğŸ”„ ë„¤ë¹„ë°”: ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¡œ ì—…ë°ì´íŠ¸ ì‹œì‘');
        
        const loginBtn = document.getElementById('mainLoginBtn');
        const userProfile = document.getElementById('userProfile');
        
        if (loginBtn && userProfile) {
            // í”„ë¡œí•„ ìˆ¨ê¸°ê³  ë¡œê·¸ì¸ ë²„íŠ¼ í‘œì‹œ
            loginBtn.style.display = 'flex';
            userProfile.style.display = 'none';
            
            console.log('âœ… ë„¤ë¹„ë°”: ë¡œê·¸ì•„ì›ƒ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ', {
                loginBtnDisplay: loginBtn.style.display,
                userProfileDisplay: userProfile.style.display
            });
        } else {
            console.error('âŒ ë„¤ë¹„ë°”: ë¡œê·¸ì•„ì›ƒ ì—…ë°ì´íŠ¸ - í•„ìˆ˜ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
        }
    }
    
    // ë„¤ë¹„ë°”ìš© ê¸°ë³¸ ì•„ë°”íƒ€ ìƒì„±
    function generateNavbarDefaultAvatar(name) {
        const initial = name ? name.charAt(0).toUpperCase() : 'U';
        const safeInitial = /^[A-Za-zê°€-í£]/.test(initial) ? initial : 'U';
        
        const svgContent = `<svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
            <circle cx="20" cy="20" r="20" fill="#667eea"/>
            <text x="20" y="26" font-family="Arial, sans-serif" font-size="16" fill="white" text-anchor="middle" dominant-baseline="central">${safeInitial}</text>
        </svg>`;
        
        return `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svgContent)}`;
    }
    
    // ì „ì—­ í•¨ìˆ˜ë¡œ ë„¤ë¹„ë°” ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ë…¸ì¶œ
    window.updateNavbarLoginState = checkAndUpdateNavbarLoginState;
    
    // ì¦‰ì‹œ ì‹¤í–‰ (ë„¤ë¹„ë°” HTMLì´ ë¡œë“œë˜ëŠ” ìˆœê°„)
    console.log('ğŸ”§ navbar.html: ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ë¨');
    checkAndUpdateNavbarLoginState();
    
    // sessionStorage ë³€ê²½ ê°ì§€ (ë‹¤ë¥¸ íƒ­ì—ì„œì˜ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë°˜ì˜)
    window.addEventListener('storage', function(e) {
        if (e.key === 'currentUser') {
            checkAndUpdateNavbarLoginState();
        }
    });
    
})();

// ë„¤ë¹„ë°” ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜ (ê° í˜ì´ì§€ì—ì„œ ì •ì˜ëœ í•¨ìˆ˜ í˜¸ì¶œ)
function showLoginModal() {
    if (window.showLoginModal && typeof window.showLoginModal === 'function') {
        window.showLoginModal();
    } else {
        // ê¸°ë³¸ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        window.location.href = 'login.html';
    }
}

// ë„¤ë¹„ë°” í”„ë¡œí•„ í´ë¦­ í•¨ìˆ˜ (ê° í˜ì´ì§€ì—ì„œ ì •ì˜ëœ í•¨ìˆ˜ í˜¸ì¶œ)
function handleProfileClick() {
    if (window.handleProfileClick && typeof window.handleProfileClick === 'function') {
        window.handleProfileClick();
    } else if (window.showProfileModal && typeof window.showProfileModal === 'function') {
        window.showProfileModal();
    } else {
        // ê¸°ë³¸ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
        window.location.href = 'employee-dashboard.html';
    }
}
</script>