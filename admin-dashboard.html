<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µí•© ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - SteelWorks Platform</title>
    
    <!-- Supabase JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Database Manager -->
    <script src="database.js"></script>
    <!-- Auth Manager -->
    <script src="shared-assets/js/auth.js"></script>
    
    <script>
        // ê´€ë¦¬ ì¹´ë“œ í´ë¦­ í•¨ìˆ˜ë“¤ì„ ì¦‰ì‹œ ì •ì˜
        window.showEmployeeManagement = function() {
            console.log('showEmployeeManagement í•¨ìˆ˜ í˜¸ì¶œë¨ - ì „ìš© í˜ì´ì§€ë¡œ ì´ë™');
            
            // ì „ìš© ì§ì›ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = 'employee-management.html';
        };


        window.showPendingMembers = function() {
            console.log('ê°€ì… ìŠ¹ì¸ í˜ì´ì§€ë¡œ ì´ë™');
            window.location.href = 'pending-members.html';
        };

        window.showDocumentManagement = function() {
            console.log('ë¬¸ì„œ ê¶Œí•œ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™');
            window.location.href = 'document-permissions.html';
        };

        window.showPermissionManagement = function() {
            console.log('ê¶Œí•œ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™');
            window.location.href = 'permission-management.html';
        };

        window.openCorporateCardManagement = function() {
            console.log('openCorporateCardManagement í•¨ìˆ˜ í˜¸ì¶œë¨');
            window.location.href = 'corporate-card.html';
        };

        window.showCompanyInfoManagement = function() {
            console.log('íšŒì‚¬ì •ë³´ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™');
            window.location.href = 'company-info.html';
        };

        // ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸° í•¨ìˆ˜
        window.backToDashboard = function() {
            console.log('backToDashboard í•¨ìˆ˜ í˜¸ì¶œë¨');
            document.querySelector('.management-container').style.display = 'flex';
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const sections = ['employees', 'documents', 'company-info', 'companyInfo'];
            sections.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                }
            });
            // íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
            history.pushState({ section: 'dashboard' }, 'ëŒ€ì‹œë³´ë“œ', '#dashboard');
        };

        // ë¬¸ì„œ í…œí”Œë¦¿ ë¡œë“œ í•¨ìˆ˜
        window.loadDocumentTemplates = function() {
            console.log('ğŸ”„ ë¬¸ì„œ í…œí”Œë¦¿ ë¡œë“œ ì‹œì‘');
            const templateContainer = document.getElementById('documentTemplates');
            console.log('ğŸ“‹ í…œí”Œë¦¿ ì»¨í…Œì´ë„ˆ ì°¾ê¸° ê²°ê³¼:', templateContainer);
            
            if (!templateContainer) {
                console.error('âŒ documentTemplates ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                // ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì»¨í…Œì´ë„ˆ ì°¾ê¸° ì‹œë„
                const allDivs = document.querySelectorAll('div[id*="document"]');
                console.log('ğŸ” document ê´€ë ¨ divë“¤:', allDivs);
                
                // backup: ì§ì ‘ HTML ì¶”ê°€
                const documentsSection = document.getElementById('documents');
                if (documentsSection) {
                    console.log('ğŸ“ documents ì„¹ì…˜ ë°œê²¬, ì§ì ‘ í…œí”Œë¦¿ ì¶”ê°€ ì‹œë„');
                    const templateHtml = `
                        <div style="padding: 2rem; margin-top: 2rem;">
                            <h3 style="color: #ffffff; margin-bottom: 2rem;">ğŸ“‹ ë¬¸ì„œ í…œí”Œë¦¿ ëª©ë¡</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                                <div style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 1.5rem;">
                                    <h4 style="color: #ffffff; margin: 0 0 1rem 0;">ğŸ“ ì—…ë¬´ì¼ì§€</h4>
                                    <p style="color: #cbd5e0; margin: 0 0 1rem 0;">ì¼ì¼ ì—…ë¬´ ë‚´ìš©ì„ ê¸°ë¡í•˜ëŠ” í…œí”Œë¦¿</p>
                                    <button onclick="window.open('worklog.html', '_blank')" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">ë¯¸ë¦¬ë³´ê¸°</button>
                                </div>
                                <div style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 1.5rem;">
                                    <h4 style="color: #ffffff; margin: 0 0 1rem 0;">ğŸ“„ ì‚¬ì§ì„œ</h4>
                                    <p style="color: #cbd5e0; margin: 0 0 1rem 0;">ì‚¬ì§ ì˜ì‚¬ë¥¼ ì „ë‹¬í•˜ëŠ” ê³µì‹ ë¬¸ì„œ</p>
                                    <button onclick="window.open('resignation-letter.html', '_blank')" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">ë¯¸ë¦¬ë³´ê¸°</button>
                                </div>
                                <div style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 1.5rem;">
                                    <h4 style="color: #ffffff; margin: 0 0 1rem 0;">ğŸ–ï¸ íœ´ê°€ì‹ ì²­ì„œ</h4>
                                    <p style="color: #cbd5e0; margin: 0 0 1rem 0;">ì—°ì°¨/ë³‘ê°€ ë“± íœ´ê°€ ì‹ ì²­ ë¬¸ì„œ</p>
                                    <button onclick="window.open('leave-request.html', '_blank')" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">ë¯¸ë¦¬ë³´ê¸°</button>
                                </div>
                                <div style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 1.5rem;">
                                    <h4 style="color: #ffffff; margin: 0 0 1rem 0;">ğŸ“ ì¬ì§ì¦ëª…ì„œ</h4>
                                    <p style="color: #cbd5e0; margin: 0 0 1rem 0;">ì¬ì§ ìƒíƒœë¥¼ ì¦ëª…í•˜ëŠ” ê³µì‹ ë¬¸ì„œ</p>
                                    <button onclick="window.open('employment-certificate.html', '_blank')" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">ë¯¸ë¦¬ë³´ê¸°</button>
                                </div>
                                <div style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 1.5rem;">
                                    <h4 style="color: #ffffff; margin: 0 0 1rem 0;">âœˆï¸ ì¶œì¥ë³´ê³ ì„œ</h4>
                                    <p style="color: #cbd5e0; margin: 0 0 1rem 0;">ì¶œì¥ ì—…ë¬´ ë‚´ìš© ë° ê²°ê³¼ ë³´ê³ ì„œ</p>
                                    <button onclick="window.open('business-trip-report.html', '_blank')" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">ë¯¸ë¦¬ë³´ê¸°</button>
                                </div>
                                <div style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 1.5rem;">
                                    <h4 style="color: #ffffff; margin: 0 0 1rem 0;">âš ï¸ ì‚¬ê³ ë³´ê³ ì„œ</h4>
                                    <p style="color: #cbd5e0; margin: 0 0 1rem 0;">ì•ˆì „ì‚¬ê³  ë° ê°ì¢… ì‚¬ê±´ ë³´ê³ ì„œ</p>
                                    <button onclick="window.open('incident-report.html', '_blank')" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">ë¯¸ë¦¬ë³´ê¸°</button>
                                </div>
                                <div style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 1.5rem;">
                                    <h4 style="color: #ffffff; margin: 0 0 1rem 0;">ğŸ“‹ ê²½ìœ„ì„œ</h4>
                                    <p style="color: #cbd5e0; margin: 0 0 1rem 0;">ì‚¬ê±´ì´ë‚˜ ì—…ë¬´ ì²˜ë¦¬ ê²½ìœ„ë¥¼ ì„¤ëª…í•˜ëŠ” ë¬¸ì„œ</p>
                                    <button onclick="window.open('explanatory-note.html', '_blank')" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">ë¯¸ë¦¬ë³´ê¸°</button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // ê¸°ì¡´ ë‚´ìš© ë’¤ì— ì¶”ê°€
                    documentsSection.insertAdjacentHTML('beforeend', templateHtml);
                    console.log('âœ… ë°±ì—… ë°©ë²•ìœ¼ë¡œ í…œí”Œë¦¿ ì¶”ê°€ ì™„ë£Œ');
                    return;
                }
                
                return;
            }

            // ê¸°ë³¸ ë¬¸ì„œ í…œí”Œë¦¿ë“¤
            const documentTemplates = [
                {
                    id: 'work-log',
                    name: 'ì—…ë¬´ì¼ì§€',
                    description: 'ì¼ì¼ ì—…ë¬´ ë‚´ìš©ì„ ê¸°ë¡í•˜ëŠ” í…œí”Œë¦¿',
                    enabled: true,
                    icon: 'fas fa-file-alt',
                    url: 'worklog.html'
                },
                {
                    id: 'resignation-letter',
                    name: 'ì‚¬ì§ì„œ',
                    description: 'ì‚¬ì§ ì˜ì‚¬ë¥¼ ì „ë‹¬í•˜ëŠ” ê³µì‹ ë¬¸ì„œ',
                    enabled: true,
                    icon: 'fas fa-file-signature',
                    url: 'resignation-letter.html'
                },
                {
                    id: 'leave-request',
                    name: 'íœ´ê°€ì‹ ì²­ì„œ',
                    description: 'ì—°ì°¨/ë³‘ê°€ ë“± íœ´ê°€ ì‹ ì²­ ë¬¸ì„œ',
                    enabled: true,
                    icon: 'fas fa-calendar-times',
                    url: 'leave-request.html'
                },
                {
                    id: 'employment-certificate',
                    name: 'ì¬ì§ì¦ëª…ì„œ',
                    description: 'ì¬ì§ ìƒíƒœë¥¼ ì¦ëª…í•˜ëŠ” ê³µì‹ ë¬¸ì„œ',
                    enabled: true,
                    icon: 'fas fa-certificate',
                    url: 'employment-certificate.html'
                },
                {
                    id: 'business-trip-report',
                    name: 'ì¶œì¥ë³´ê³ ì„œ',
                    description: 'ì¶œì¥ ì—…ë¬´ ë‚´ìš© ë° ê²°ê³¼ ë³´ê³ ì„œ',
                    enabled: true,
                    icon: 'fas fa-plane',
                    url: 'business-trip-report.html'
                },
                {
                    id: 'incident-report',
                    name: 'ì‚¬ê³ ë³´ê³ ì„œ',
                    description: 'ì•ˆì „ì‚¬ê³  ë° ê°ì¢… ì‚¬ê±´ ë³´ê³ ì„œ',
                    enabled: true,
                    icon: 'fas fa-exclamation-triangle',
                    url: 'incident-report.html'
                },
                {
                    id: 'explanatory-note',
                    name: 'ê²½ìœ„ì„œ',
                    description: 'ì‚¬ê±´ì´ë‚˜ ì—…ë¬´ ì²˜ë¦¬ ê²½ìœ„ë¥¼ ì„¤ëª…í•˜ëŠ” ë¬¸ì„œ',
                    enabled: true,
                    icon: 'fas fa-file-text',
                    url: 'explanatory-note.html'
                }
            ];

            let html = '';
            documentTemplates.forEach(template => {
                html += `
                    <div class="document-template-card" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="color: #667eea; font-size: 2rem;">
                                    <i class="${template.icon}"></i>
                                </div>
                                <div>
                                    <h4 style="color: #ffffff; margin: 0 0 0.5rem 0; font-size: 1.25rem;">${template.name}</h4>
                                    <p style="color: #cbd5e0; margin: 0; font-size: 0.9rem;">${template.description}</p>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label style="color: #ffffff; font-size: 0.9rem;">í‘œì‹œ:</label>
                                <input type="checkbox" id="template_${template.id}" ${template.enabled ? 'checked' : ''} 
                                       onchange="toggleTemplate('${template.id}')"
                                       style="transform: scale(1.2);">
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
                            <button class="btn btn-sm" onclick="previewTemplate('${template.url}')" 
                                    style="background: linear-gradient(135deg, #667eea, #764ba2); font-size: 0.85rem; padding: 0.5rem 1rem;">
                                <i class="fas fa-eye"></i> ë¯¸ë¦¬ë³´ê¸°
                            </button>
                            <button class="btn btn-sm" onclick="editTemplate('${template.id}')" 
                                    style="background: linear-gradient(135deg, #f59e0b, #d97706); font-size: 0.85rem; padding: 0.5rem 1rem;">
                                <i class="fas fa-edit"></i> í¸ì§‘
                            </button>
                        </div>
                    </div>
                `;
            });

            templateContainer.innerHTML = html;
            console.log('ë¬¸ì„œ í…œí”Œë¦¿ ë¡œë“œ ì™„ë£Œ:', documentTemplates.length, 'ê°œ');
        };

        // í…œí”Œë¦¿ ê´€ë ¨ í•¨ìˆ˜ë“¤
        window.previewTemplate = function(url) {
            console.log('í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸°:', url);
            window.open(url, '_blank');
        };

        window.editTemplate = function(templateId) {
            console.log('í…œí”Œë¦¿ í¸ì§‘:', templateId);
            
            // í…œí”Œë¦¿ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const templateData = {
                'work-log': { name: 'ì—…ë¬´ì¼ì§€', content: 'ì—…ë¬´ì¼ì§€ í…œí”Œë¦¿ ë‚´ìš©...' },
                'resignation-letter': { name: 'ì‚¬ì§ì„œ', content: 'ì‚¬ì§ì„œ í…œí”Œë¦¿ ë‚´ìš©...' },
                'leave-request': { name: 'íœ´ê°€ì‹ ì²­ì„œ', content: 'íœ´ê°€ì‹ ì²­ì„œ í…œí”Œë¦¿ ë‚´ìš©...' },
                'employment-certificate': { name: 'ì¬ì§ì¦ëª…ì„œ', content: 'ì¬ì§ì¦ëª…ì„œ í…œí”Œë¦¿ ë‚´ìš©...' },
                'business-trip-report': { name: 'ì¶œì¥ë³´ê³ ì„œ', content: 'ì¶œì¥ë³´ê³ ì„œ í…œí”Œë¦¿ ë‚´ìš©...' },
                'incident-report': { name: 'ì‚¬ê³ ë³´ê³ ì„œ', content: 'ì‚¬ê³ ë³´ê³ ì„œ í…œí”Œë¦¿ ë‚´ìš©...' },
                'explanatory-note': { name: 'ê²½ìœ„ì„œ', content: 'ê²½ìœ„ì„œ í…œí”Œë¦¿ ë‚´ìš©...' }
            };
            
            const template = templateData[templateId];
            if (!template) {
                alert('í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í¸ì§‘ ëª¨ë‹¬ í‘œì‹œ
            showTemplateEditModal(templateId, template.name, template.content);
        };

        window.toggleTemplate = function(templateId) {
            console.log('í…œí”Œë¦¿ í† ê¸€:', templateId);
            const checkbox = document.getElementById(`template_${templateId}`);
            if (checkbox) {
                console.log(`í…œí”Œë¦¿ ${templateId} í‘œì‹œ ìƒíƒœ:`, checkbox.checked ? 'í™œì„±' : 'ë¹„í™œì„±');
            }
        };

        window.saveDocumentSettings = function() {
            console.log('ë¬¸ì„œ ì„¤ì • ì €ì¥');
            alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        };

        // í…œí”Œë¦¿ í¸ì§‘ ëª¨ë‹¬ í•¨ìˆ˜ë“¤
        window.showTemplateEditModal = function(templateId, templateName, templateContent) {
            console.log('í…œí”Œë¦¿ í¸ì§‘ ëª¨ë‹¬ í‘œì‹œ:', templateId);
            
            // ëª¨ë‹¬ ìš”ì†Œ ì°¾ê¸°
            const modal = document.getElementById('templateEditModal');
            if (!modal) {
                console.error('í…œí”Œë¦¿ í¸ì§‘ ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í¼ í•„ë“œì— ê°’ ì„¤ì •
            const nameInput = document.getElementById('templateEditName');
            const contentTextarea = document.getElementById('templateEditContent');
            
            if (nameInput) nameInput.value = templateName;
            if (contentTextarea) contentTextarea.value = templateContent;
            
            // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ í…œí”Œë¦¿ ID ì €ì¥
            window.currentEditingTemplateId = templateId;
            
            // ëª¨ë‹¬ í‘œì‹œ
            modal.style.display = 'flex';
        };

        window.closeTemplateEdit = function() {
            console.log('í…œí”Œë¦¿ í¸ì§‘ ëª¨ë‹¬ ë‹«ê¸°');
            const modal = document.getElementById('templateEditModal');
            if (modal) {
                modal.style.display = 'none';
            }
            window.currentEditingTemplateId = null;
        };

        window.saveTemplateEdit = function() {
            console.log('í…œí”Œë¦¿ í¸ì§‘ ì €ì¥');
            
            const templateId = window.currentEditingTemplateId;
            if (!templateId) {
                alert('í¸ì§‘ ì¤‘ì¸ í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const nameInput = document.getElementById('templateEditName');
            const contentTextarea = document.getElementById('templateEditContent');
            
            if (!nameInput || !contentTextarea) {
                alert('í¸ì§‘ í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const newName = nameInput.value.trim();
            const newContent = contentTextarea.value.trim();
            
            if (!newName || !newContent) {
                alert('í…œí”Œë¦¿ ì´ë¦„ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì—¬ê¸°ì„œ ì‹¤ì œ ì €ì¥ ë¡œì§ êµ¬í˜„
            console.log('í…œí”Œë¦¿ ì €ì¥:', {
                id: templateId,
                name: newName,
                content: newContent
            });
            
            // ìŠ¹ì¸ì ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
            showApprovalModal(templateId, newName, newContent);
        };

        // ìµœì¢… ìŠ¹ì¸ì ì„ íƒ ëª¨ë‹¬
        window.showApprovalModal = function(templateId, templateName, templateContent) {
            console.log('ìŠ¹ì¸ì ì„ íƒ ëª¨ë‹¬ í‘œì‹œ');
            
            // ê°„ë‹¨í•œ ìŠ¹ì¸ì ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸
            const approvers = [
                'ê¹€ì² ìˆ˜ (ëŒ€í‘œì´ì‚¬)',
                'ì´ì˜í¬ (ê´€ë¦¬ë¶€ì¥)',
                'ë°•ë¯¼ìˆ˜ (ì¸ì‚¬íŒ€ì¥)',
                'ìµœì§€ì˜ (ì´ë¬´íŒ€ì¥)'
            ];
            
            let approverOptions = 'ìµœì¢… ìŠ¹ì¸ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”:\n\n';
            approvers.forEach((approver, index) => {
                approverOptions += `${index + 1}. ${approver}\n`;
            });
            
            const selection = prompt(approverOptions + '\në²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (1-4):');
            
            if (selection && selection >= 1 && selection <= 4) {
                const selectedApprover = approvers[selection - 1];
                
                // ìµœì¢… ì €ì¥ í™•ì¸
                if (confirm(`í…œí”Œë¦¿: ${templateName}\nìŠ¹ì¸ì: ${selectedApprover}\n\nì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    console.log('í…œí”Œë¦¿ ìµœì¢… ì €ì¥:', {
                        id: templateId,
                        name: templateName,
                        content: templateContent,
                        approver: selectedApprover
                    });
                    
                    alert('í…œí”Œë¦¿ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeTemplateEdit();
                }
            } else if (selection !== null) {
                alert('ì˜¬ë°”ë¥¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                showApprovalModal(templateId, templateName, templateContent);
            }
        };

        console.log('âœ… ëª¨ë“  ê´€ë¦¬ í•¨ìˆ˜ë“¤ì´ ì „ì—­ ìŠ¤ì½”í”„ì— ì •ì˜ë¨');
    </script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .admin-dashboard {
            display: block;
            min-height: 100vh;
        }

        .admin-header {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem 2rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: #ffffff;
            font-size: 1.5rem;
            font-weight: 800;
        }

        .admin-nav {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-btn:hover,
        .nav-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .admin-content {
            padding: 2rem;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 2rem;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .data-grid {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .grid-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .grid-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ffffff;
        }

        .btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #e2e8f0;
            font-weight: 600;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: #ffffff !important;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.7);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff !important;
        }

        /* ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì˜µì…˜ ìŠ¤íƒ€ì¼ë§ */
        .form-select option {
            background: #2d3748;
            color: #ffffff;
            padding: 0.5rem;
            font-weight: 500;
        }

        .form-select option:hover {
            background: #4a5568;
            color: #ffffff;
        }

        .form-input::placeholder, .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .form-input::-webkit-input-placeholder, .form-textarea::-webkit-input-placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .form-input::-moz-placeholder, .form-textarea::-moz-placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .form-input:-ms-input-placeholder, .form-textarea:-ms-input-placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .image-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .image-upload-area:hover {
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.1);
        }

        .image-upload-area i {
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 1rem;
        }

        .employee-table {
            width: 100%;
            border-collapse: collapse;
        }

        .employee-table th,
        .employee-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .employee-table th {
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            font-weight: 700;
        }

        .employee-table td {
            color: #e2e8f0;
        }

        .role-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .role-master {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .role-admin {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .role-manager {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }

        .role-employee {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }


        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal[style*="block"] {
            display: flex !important;
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 2rem;
            border-radius: 15px;
            max-width: 800px;
            width: 95%;
            color: white;
            max-height: 95vh;
            overflow-y: auto;
            min-height: 700px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h3 {
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
        }

        .close-btn:hover {
            opacity: 1;
        }

        .employee-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .employee-info h4 {
            margin: 0 0 0.5rem 0;
            color: #ffffff;
            font-size: 1.2rem;
        }

        .employee-info p {
            margin: 0.25rem 0;
            color: #e2e8f0;
            font-size: 0.9rem;
        }

        .employee-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-actions .btn {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            min-width: 120px;
        }

        /* ë©”ì¸ ê´€ë¦¬ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .management-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70vh;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 2rem;
        }

        .management-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 3rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .management-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            width: 100%;
            max-width: 800px;
        }

        .management-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
        }

        .management-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        /* ì•Œë¦¼ ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .notification-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .management-card i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            display: block;
        }
        
        /* ì¹´ë“œë³„ ì•„ì´ì½˜ ìƒ‰ìƒ */
        .employees-card i { color: #3b82f6; }
        .pending-members-card i { color: #10b981; }
        .documents-card i { color: #f59e0b; }
        .permission-card i { color: #8b5cf6; }
        .corporate-card-card i { color: #ef4444; }
        .company-info-card i { color: #6366f1; }
        .quote-requests-card i { color: #06b6d4; }

        .management-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .management-card p {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.6;
        }

        .homepage-card {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .homepage-management-card {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .employees-card {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }


        .company-info-card {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
        }


        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            color: #e2e8f0;
            font-size: 0.9rem;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 0.5rem;
        }


        .badge {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-indicator {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: rgba(0, 0, 0, 0.7);
            padding: 1rem;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
        }

        .close:hover {
            opacity: 1;
        }

        /* ì•Œë¦¼ ë°°ì§€ */
        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                gap: 1rem;
            }

            .admin-nav {
                justify-content: center;
            }

            .form-row {
                flex-direction: column;
            }

            .admin-content {
                padding: 1rem;
            }

            .management-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .management-title {
                font-size: 2rem;
            }

            .management-card {
                min-height: 150px;
                padding: 1.5rem;
            }

            .management-card i {
                font-size: 3rem;
                margin-bottom: 1rem;
            }

            .management-card h3 {
                font-size: 1.25rem;
            }

            .management-card p {
                font-size: 0.9rem;
            }
        }


        /* ë¬¸ì„œ ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
        .document-management {
            width: 100%;
        }

        .template-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .template-header {
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .template-actions {
            display: flex;
            gap: 0.5rem;
        }

        .template-content {
            padding: 1.5rem;
        }

        .template-preview {
            position: relative;
        }

        .btn-small {
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
        }

        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4a5568;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: #10b981;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .document-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .document-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .document-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .document-template {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: #ffffff !important;
            resize: vertical;
            font-family: 'Noto Sans KR', sans-serif;
            padding: 1rem;
            line-height: 1.5;
        }

        .document-template:focus {
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff !important;
        }

        .document-template::placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .document-template::-webkit-input-placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .document-template::-moz-placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .document-template:-ms-input-placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ ìŠ¤íƒ€ì¼ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #10b981;
        }

        input:focus + .toggle-slider {
            box-shadow: 0 0 1px #10b981;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .documents-grid {
                grid-template-columns: 1fr;
            }
            
            .document-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }


        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            border-radius: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        .empty-state, .error-state {
            text-align: center;
            padding: 3rem 2rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .empty-state i, .error-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: #ffffff;
            margin: 0;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: #ffffff;
            background: rgba(255, 255, 255, 0.1);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-group select, .form-group input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 1rem;
        }

        .form-group select:focus, .form-group input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.7);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-group select option {
            background: #2d3748;
            color: #ffffff;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #ffffff;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            
            .modal-content {
                width: 95%;
                margin: 1rem;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="admin-dashboard">
        <!-- Header -->
        <header class="admin-header">
            <div class="admin-logo">
                <i class="fas fa-cogs"></i>
                <span id="companyTitle">ë‚¨ê²½ìŠ¤í‹¸(ì£¼) - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</span>
            </div>
            <div class="admin-nav">
                <a href="employee-dashboard.html" class="nav-btn">
                    <i class="fas fa-users"></i>
                    ì§ì› ëŒ€ì‹œë³´ë“œ
                </a>
            </div>
        </header>

        <!-- Content -->
        <main class="admin-content">
            <div class="management-container" style="display: flex;">
                <h1 class="management-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                
                <div class="management-grid">
                    <a href="index.html" class="management-card homepage-card">
                        <i class="fas fa-home"></i>
                        <h3>í™ˆí˜ì´ì§€</h3>
                        <p>ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ë¥¼ í™•ì¸í•˜ê³  ë³€ê²½ëœ ë‚´ìš©ì„ ë¯¸ë¦¬ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </a>
                    
                    <button class="management-card employees-card" id="employeeManagementBtn" onclick="console.log('ì§ì› ê´€ë¦¬ í´ë¦­'); showEmployeeManagement();">
                        <i class="fas fa-users"></i>
                        <h3>ì§ì› ê´€ë¦¬</h3>
                        <p>ì§ì› ì •ë³´ë¥¼ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•˜ê³  ì—­í• ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                    </button>
                    
                    
                    <button class="management-card pending-members-card" id="pendingMembersBtn" onclick="console.log('ê°€ì… ìŠ¹ì¸ í´ë¦­'); showPendingMembers();">
                        <i class="fas fa-user-check"></i>
                        <h3>ê°€ì… ìŠ¹ì¸</h3>
                        <p>ì‹ ê·œ íšŒì›ê°€ì… ìš”ì²­ì„ ê²€í† í•˜ê³  ìŠ¹ì¸/ë°˜ë ¤ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
                    </button>
                    
                    <button class="management-card documents-card" id="documentManagementBtn" onclick="console.log('ë¬¸ì„œ ê´€ë¦¬ í´ë¦­'); showDocumentManagement();">
                        <i class="fas fa-file-alt"></i>
                        <h3>ë¬¸ì„œ ê´€ë¦¬</h3>
                        <p>ê°ì¢… ì„œë¥˜ í…œí”Œë¦¿ì„ ê´€ë¦¬í•˜ê³  ê²°ì¬ ì‹œìŠ¤í…œ í‘œì‹œ ì—¬ë¶€ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                    </button>
                    
                    <button class="management-card permission-card" id="permissionManagementBtn" onclick="console.log('ê¶Œí•œ ê´€ë¦¬ í´ë¦­'); showPermissionManagement();">
                        <i class="fas fa-user-shield"></i>
                        <h3>ê¶Œí•œ ê´€ë¦¬</h3>
                        <p>ì‚¬ìš©ìë³„, ë¶€ì„œë³„, ì§ê¸‰ë³„ ì„¸ë¶€ ê¶Œí•œì„ ì„¤ì •í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                    </button>
                    
                    <button class="management-card corporate-card-card" id="corporateCardManagementBtn" onclick="console.log('ë²•ì¸ì¹´ë“œ ê´€ë¦¬ í´ë¦­'); openCorporateCardManagement();" style="position: relative;">
                        <i class="fas fa-credit-card"></i>
                        <span id="adminCardNotificationBadge" class="notification-badge" style="display: none;">0</span>
                        <h3>ë²•ì¸ì¹´ë“œ ê´€ë¦¬</h3>
                        <p>ë²•ì¸ì¹´ë“œ ì‚¬ìš© ë‚´ì—­ì„ ì¡°íšŒí•˜ê³  ìŠ¹ì¸/ë°˜ë ¤ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
                    </button>
                    
                    <button class="management-card company-info-card" id="companyInfoManagementBtn" onclick="window.location.href='company-info.html';">
                        <i class="fas fa-building"></i>
                        <h3>íšŒì‚¬ì •ë³´</h3>
                        <p>íšŒì‚¬ ê¸°ë³¸ì •ë³´, ì‚¬ì—…ìë“±ë¡ì¦, ë²•ì¸ë“±ë¡ë²ˆí˜¸ ë“±ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                    </button>
                    
                    <button class="management-card quote-requests-card" id="quoteRequestsBtn" onclick="window.location.href='request-management.html';">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <h3>ê²¬ì ìš”ì²­</h3>
                        <p>ê²¬ì  ìš”ì²­, ì¹´íƒˆë¡œê·¸ ìš”ì²­, ê¸°ìˆ ì§€ì› ìš”ì²­ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                        <div id="requestNotificationBadge" class="notification-badge" style="display: none;">
                            <span id="requestNotificationCount">0</span>
                        </div>
                    </button>
                </div>
            </div>
            <!-- ì§ì› ê´€ë¦¬ ì„¹ì…˜ì€ ë³„ë„ì˜ employee-management.html í˜ì´ì§€ë¡œ ì´ë™ -->

            <section class="content-section" id="documents" style="display: none;">
                <button class="btn btn-secondary" onclick="backToDashboard()" style="margin-bottom: 1rem;">
                    <i class="fas fa-arrow-left"></i> ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                </button>
                <h2 class="section-title">ë¬¸ì„œ ê´€ë¦¬</h2>
                
                <div class="data-grid">
                    <div class="grid-header">
                        <h3 class="grid-title">ì„œë¥˜ í…œí”Œë¦¿ ê´€ë¦¬</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="saveDocumentSettings()" style="background: linear-gradient(135deg, #10b981, #059669);">
                                <i class="fas fa-save"></i> ì„¤ì • ì €ì¥
                            </button>
                        </div>
                    </div>
                    <div style="padding: 2rem;">
                        <div class="document-management">
                            <!-- ë¬¸ì„œ í…œí”Œë¦¿ ë¦¬ìŠ¤íŠ¸ -->
                            <div style="margin-bottom: 2rem;">
                                <h3 style="color: #ffffff; margin: 0;">ë¬¸ì„œ í…œí”Œë¦¿ ê´€ë¦¬</h3>
                            </div>

                            <!-- ë¬¸ì„œ í…œí”Œë¦¿ ì¹´ë“œë“¤ -->
                            <div id="documentTemplates" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 1.5rem;">

                            </div>

                            <!-- í…œí”Œë¦¿ í¸ì§‘ ëª¨ë‹¬ -->
                            <div id="templateEditModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
                                <div style="background: #2d3748; border-radius: 15px; padding: 2rem; width: 90%; max-width: 800px; max-height: 90%; overflow-y: auto;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                                        <h3 style="color: #ffffff; margin: 0;">í…œí”Œë¦¿ í¸ì§‘</h3>
                                        <button onclick="closeTemplateEdit()" style="background: none; border: none; color: #ffffff; font-size: 1.5rem; cursor: pointer;">&times;</button>
                                    </div>
                                    <div style="margin-bottom: 1rem;">
                                        <label style="display: block; color: #ffffff; margin-bottom: 0.5rem;">í…œí”Œë¦¿ ì´ë¦„</label>
                                        <input type="text" id="templateEditName" style="width: 100%; padding: 0.75rem; border: 1px solid #4a5568; border-radius: 8px; background: #1a202c; color: #ffffff;">
                                    </div>
                                    <div style="margin-bottom: 2rem;">
                                        <label style="display: block; color: #ffffff; margin-bottom: 0.5rem;">í…œí”Œë¦¿ ë‚´ìš©</label>
                                        <textarea id="templateEditContent" style="width: 100%; height: 400px; padding: 0.75rem; border: 1px solid #4a5568; border-radius: 8px; background: #1a202c; color: #ffffff; font-family: monospace; font-size: 0.9rem; line-height: 1.6;"></textarea>
                                    </div>
                                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                                        <button class="btn btn-secondary" onclick="closeTemplateEdit()">ì·¨ì†Œ</button>
                                        <button class="btn" onclick="saveTemplateEdit()" style="background: linear-gradient(135deg, #10b981, #059669);">
                                            <i class="fas fa-save"></i> ì €ì¥
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
                            <div id="templatePreviewModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000;">
                                <div style="background: #ffffff; border-radius: 15px; padding: 2rem; width: 90%; max-width: 600px; max-height: 90%; overflow-y: auto; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 1rem;">
                                        <h3 style="color: #333; margin: 0;">ë¯¸ë¦¬ë³´ê¸°</h3>
                                        <button onclick="closeTemplatePreview()" style="background: none; border: none; color: #666; font-size: 1.5rem; cursor: pointer;">&times;</button>
                                    </div>
                                    <div id="previewContent" style="color: #333; line-height: 1.8; white-space: pre-line;">
                                        <!-- ë¯¸ë¦¬ë³´ê¸° ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                                    </div>
                                    <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                                        <button class="btn btn-secondary" onclick="closeTemplatePreview()">ë‹«ê¸°</button>
                                        <button class="btn" onclick="printTemplate()" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">
                                            <i class="fas fa-print"></i> ì¸ì‡„
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- ì§ì› ê´€ë¦¬ ëª¨ë‹¬ë“¤ì€ employee-management.htmlë¡œ ì´ë™ -->

        <!-- ìƒíƒœ í‘œì‹œ -->
        <div id="statusIndicator" class="status-indicator">
            <div class="status-item">
                <span id="dataStatus">ğŸ’¾ ë°ì´í„°: ë¡œë”© ì¤‘...</span>
            </div>
        </div>
    </div>

    <script>
        // shared-assets/js/auth.jsì—ì„œ AuthManagerë¥¼ ë¡œë“œí•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì‚­ì œ

        // ì „ì—­ ë³€ìˆ˜
        let currentTemplate = null;
        let currentEditingEmployee = null;

        // íšŒì‚¬ëª… ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateCompanyTitle(companyId) {
            console.log('ğŸ¢ íšŒì‚¬ëª… ì—…ë°ì´íŠ¸:', companyId);
            
            if (!companyId) {
                console.log('âŒ companyIdê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            const company = companies.find(c => c.id === companyId);
            
            const companyNameMap = {
                'seokyoung-snt': 'ì„œê²½ S&T',
                'posco': 'í¬ìŠ¤ì½” ì² ê°•',
                'hyundai-steel': 'í˜„ëŒ€ì œì² ',
                'namkyung-steel': 'ë‚¨ê²½ìŠ¤í‹¸',
                'new-test-company': 'ìƒˆë¡œìš´í…ŒìŠ¤íŠ¸íšŒì‚¬',
                '': 'ë‚¨ê²½ìŠ¤í‹¸' // ë¹ˆ íŒŒë¼ë¯¸í„° ì²˜ë¦¬
            };
            
            const companyName = company?.companyName || companyNameMap[companyId] || companyId;
            const titleElement = document.getElementById('companyTitle');
            
            console.log('ğŸ“‹ ì°¾ì€ íšŒì‚¬ ì •ë³´:', {
                companyId,
                company,
                companyName,
                titleElement: !!titleElement
            });
            
            if (titleElement) {
                const newTitle = `${companyName} - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ`;
                titleElement.textContent = newTitle;
                document.title = newTitle;
                console.log('âœ… íšŒì‚¬ëª… ì—…ë°ì´íŠ¸ ì™„ë£Œ:', newTitle);
                
            } else {
                console.log('âŒ titleElementë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStatus() {
            const statusElement = document.getElementById('dataStatus');
            const data = localStorage.getItem(`template_${currentTemplate}_settings`);
            
            if (data) {
                const parsed = JSON.parse(data);
                const companyName = parsed.basic?.companyName || 'ë¯¸ì„¤ì •';
                statusElement.innerHTML = `ğŸ’¾ ë°ì´í„°: âœ… ì €ì¥ë¨ (${companyName})`;
            } else {
                statusElement.innerHTML = 'ğŸ’¾ ë°ì´í„°: âŒ ì—†ìŒ';
            }
        }
        
        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë“¤
        function handleEditClick(e) {
            e.preventDefault();
            e.stopPropagation();
            const employeeId = this.getAttribute('data-employee-id');
            console.log('ğŸ“ ìˆ˜ì • ë²„íŠ¼ í´ë¦­ (í•¸ë“¤ëŸ¬):', employeeId);
            editEmployee(employeeId);
        }

        function handleDeleteClick(e) {
            e.preventDefault();
            e.stopPropagation();
            const employeeId = this.getAttribute('data-employee-id');
            console.log('ğŸ—‘ï¸ ì‚­ì œ ë²„íŠ¼ í´ë¦­ (í•¸ë“¤ëŸ¬):', employeeId);
            deleteEmployee(employeeId);
        }

        // ì „ì—­ í•¨ìˆ˜ ë“±ë¡ (onclickì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡)
        window.editEmployee = editEmployee;
        window.simpleEditEmployee = simpleEditEmployee;
        window.deleteEmployee = deleteEmployee;
        window.openEmployeeModal = openEmployeeModal;
        window.closeEmployeeModal = closeEmployeeModal;
        window.saveEmployee = saveEmployee;
        window.backToDashboard = backToDashboard;
        window.showEmployeeManagement = showEmployeeManagement;
        window.showPermissionManagement = showPermissionManagement;
        window.handleEditClick = handleEditClick;
        window.handleDeleteClick = handleDeleteClick;
        window.openEmployeeSettingsModal = openEmployeeSettingsModal;
        window.closeEmployeeSettingsModal = closeEmployeeSettingsModal;
        window.addDepartment = addDepartment;
        window.addPosition = addPosition;
        window.removeDepartment = removeDepartment;
        window.removePosition = removePosition;
        window.showSection = showSection;
        window.handleHashChange = handleHashChange;
        window.testFormElementsAccessibility = testFormElementsAccessibility;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì‹œì‘');
            
            // ê´€ë¦¬ ì¹´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const employeeBtn = document.getElementById('employeeManagementBtn');
            const documentBtn = document.getElementById('documentManagementBtn');
            const corporateBtn = document.getElementById('corporateCardManagementBtn');
            const companyBtn = document.getElementById('companyInfoManagementBtn');
            
            if (employeeBtn) {
                employeeBtn.addEventListener('click', showEmployeeManagement);
            }
            if (documentBtn) {
                documentBtn.addEventListener('click', showDocumentManagement);
            }
            if (corporateBtn) {
                corporateBtn.addEventListener('click', openCorporateCardManagement);
            }
            if (companyBtn) {
                companyBtn.addEventListener('click', showCompanyInfoManagement);
            }
            
            // localStorage ì´ˆê¸° ìƒíƒœ í™•ì¸
            console.log('ğŸ” í˜ì´ì§€ ë¡œë“œ ì‹œ localStorage ìƒíƒœ:');
            const initialEmployeesData = localStorage.getItem('employees');
            console.log('  ğŸ“ employees:', initialEmployeesData ? JSON.parse(initialEmployeesData).length + 'ëª…' : 'ì—†ìŒ');
            
            // ëª¨ë“  company_*_employees í‚¤ í™•ì¸
            const allKeys = Object.keys(localStorage);
            const companyKeys = allKeys.filter(key => key.startsWith('company_') && key.endsWith('_employees'));
            console.log('  ğŸ“ íšŒì‚¬ë³„ ì§ì› ë°ì´í„°:', companyKeys.length + 'ê°œ');
            companyKeys.forEach(key => {
                const data = localStorage.getItem(key);
                if (data) {
                    const parsed = JSON.parse(data);
                    console.log(`    ${key}: ${parsed.length}ëª…`);
                }
            });
            
            // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ì§ì› ë°ì´í„° ì¬ë¡œë“œ ê°•í™”
            setTimeout(async () => {
                console.log('ğŸ”„ í˜ì´ì§€ ë¡œë“œ í›„ ì§ì› ë°ì´í„° ì¬í™•ì¸');
                const currentEmployeesData = localStorage.getItem('employees');
                if (currentEmployeesData) {
                    const employees = JSON.parse(currentEmployeesData);
                    console.log('ğŸ“Š ì§ì› ë°ì´í„° ì¬í™•ì¸:', employees.length + 'ëª…');
                } else {
                    console.log('âš ï¸ ì§ì› ë°ì´í„°ê°€ ì—†ìŒ!');
                }
                
                // ê°•ì œë¡œ ë‹¤ì‹œ ë Œë”ë§
                await renderEmployeeList();
            }, 1000);
            
            // ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œì—ì„œ ì˜¨ ê²½ìš° ì²´í¬
            const masterAccess = JSON.parse(localStorage.getItem('master_company_access') || '{}');
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company');
            
            console.log('ğŸ” ì´ˆê¸°í™” ì •ë³´:', {
                masterAccess,
                companyId,
                currentUrl: window.location.href
            });
            
            // ì•Œë¦¼ ì²´í¬
            setTimeout(() => {
                checkAdminNotifications();
            }, 500);
            
            // AuthManagerê°€ ë¡œë“œë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¼
            if (typeof AuthManager === 'undefined') {
                console.error('âŒ AuthManagerê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì¬ë¡œë“œí•©ë‹ˆë‹¤.');
                setTimeout(() => location.reload(), 1000);
                return;
            }
            
            let user = AuthManager.getCurrentUser();
            
            // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì ‘ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì¤‘ë³µ ì œê±°)
            if (user && user.email) {
                try {
                    const { data: dbUser, error } = await window.db.client
                        .from('users')
                        .select('*')
                        .eq('email', user.email)
                        .single();
                    
                    if (dbUser && !error) {
                        // ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´ë¥¼ ì§ì ‘ ì‚¬ìš© (ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸ ì œê±°)
                        user = {
                            id: dbUser.id,
                            email: dbUser.email,
                            name: dbUser.name,
                            role: dbUser.role,
                            is_approved: dbUser.is_approved,
                            is_active: dbUser.is_active,
                            department: dbUser.department,
                            position: dbUser.position,
                            company_domain: dbUser.company_domain,
                            company_name: dbUser.company_name
                        };
                        console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìµœì‹  ì‚¬ìš©ì ì •ë³´ ë¡œë“œ:', user);
                    }
                } catch (error) {
                    console.error('âŒ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                }
            }
            
            // ë§ˆìŠ¤í„° ê¶Œí•œìœ¼ë¡œ ì ‘ê·¼í•œ ê²½ìš°
            if (masterAccess.role === 'master' && companyId === masterAccess.companyId) {
                console.log('ğŸ”‘ ë§ˆìŠ¤í„° ê¶Œí•œìœ¼ë¡œ íšŒì‚¬ ëŒ€ì‹œë³´ë“œ ì ‘ê·¼:', companyId);
                const masterUser = JSON.parse(localStorage.getItem('steelplatform_currentUser') || localStorage.getItem('currentUser') || '{}');
                if (masterUser.role === 'master') {
                    AuthManager.setCurrentUser(masterUser);
                    user = masterUser;
                    console.log('âœ… ë§ˆìŠ¤í„° ì‚¬ìš©ì ê¶Œí•œ ì„¤ì • ì™„ë£Œ');
                }
                
                // íšŒì‚¬ëª… ì—…ë°ì´íŠ¸
                updateCompanyTitle(companyId);
            }
            
            // ë””ë²„ê·¸ ì •ë³´ ì¶”ê°€
            console.log('ğŸ•µï¸ ì‚¬ìš©ì ì¸ì¦ í™•ì¸:', {
                user: user,
                userRole: user?.role,
                sessionStorage: sessionStorage.getItem('currentUser'),
                AuthManager: typeof AuthManager
            });
            
            if (!user) {
                // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‹¤ì œ ì‚¬ìš©ì í™•ì¸ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸
                console.error('âŒ ì¸ì¦ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                alert('ë¡œê·¸ì¸ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                window.location.href = 'login.html';
                return;
            }
            
            // ê¶Œí•œ í™•ì¸
            if (!hasAdminPermission(user)) {
                alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                console.log('âŒ ê¶Œí•œ ì—†ìŒ:', user);
                return;
            }
            
            console.log('âœ… í˜„ì¬ ì‚¬ìš©ì:', user);
            
            currentTemplate = localStorage.getItem('currentTemplateId') || 'scout';
            if (currentTemplate) {
                // íšŒì‚¬ëª… ë™ì  ì—…ë°ì´íŠ¸
                if (companyId) {
                    updateCompanyTitle(companyId);
                } else {
                    // URLì—ì„œ company íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” ê²½ìš°, ê¸°ë³¸ê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                    const titleElement = document.getElementById('companyTitle');
                    if (titleElement) {
                        titleElement.textContent = 'í†µí•© ê´€ë¦¬ì - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ';
                        document.title = 'í†µí•© ê´€ë¦¬ì - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ';
                    }
                }
            }
            
            // ë°ì´í„° ì§€ì†ì„± ë³´ì¥
            ensureDataPersistence();
            
            // ë¨¼ì € ê¸°ì¡´ ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³ , ì—†ì„ ë•Œë§Œ ì´ˆê¸°í™”
            loadEmployeesFromDatabase();
            loadData();
            setupEventListeners();
            updateStatus();
            updateEmployeeFormOptions(); // ë¶€ì„œ ë° ì§ì±… ì˜µì…˜ ì´ˆê¸°í™”
            
            // ì§ì› ëª©ë¡ ê°•ì œ ë Œë”ë§ (ì—¬ëŸ¬ ë²ˆ ì‹œë„)
            setTimeout(async () => {
                console.log('ğŸ”„ ì§ì› ëª©ë¡ ê°•ì œ ë Œë”ë§ ì‹œì‘ (1ì°¨)');
                await renderEmployeeList();
                
                // 2ì´ˆ í›„ ë‹¤ì‹œ ì‹œë„
                setTimeout(async () => {
                    console.log('ğŸ”„ ì§ì› ëª©ë¡ ê°•ì œ ë Œë”ë§ ì‹œì‘ (2ì°¨)');
                    await renderEmployeeList();
                    
                    // ë Œë”ë§ í™•ì¸
                    setTimeout(() => {
                        const employeeList = document.getElementById('employeeList');
                        console.log('ğŸ“‹ ì§ì› ëª©ë¡ ì»¨í…Œì´ë„ˆ:', employeeList);
                        console.log('ğŸ”„ ì§ì› ëª©ë¡ HTML:', employeeList?.innerHTML?.substring(0, 200) + '...');
                        
                        // ìˆ˜ì • ë²„íŠ¼ì´ ìˆëŠ”ì§€ í™•ì¸
                        const editButtons = document.querySelectorAll('.edit-employee-btn');
                        console.log('ğŸ“ ìˆ˜ì • ë²„íŠ¼ ê°œìˆ˜:', editButtons.length);
                        editButtons.forEach((btn, index) => {
                            console.log(`ìˆ˜ì • ë²„íŠ¼ ${index}:`, btn);
                        });
                        
                        // ëª¨ë‹¬ í™•ì¸
                        const modal = document.getElementById('employeeModal');
                        console.log('ğŸ­ ëª¨ë‹¬ ìš”ì†Œ:', modal);
                        
                        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤ ì „ì—­ ë“±ë¡ í™•ì¸
                        console.log('ğŸ”§ simpleEditEmployee í•¨ìˆ˜:', window.simpleEditEmployee);
                        console.log('â• openEmployeeModal í•¨ìˆ˜:', window.openEmployeeModal);
                    }, 500);
                }, 2000);
            }, 500);
            
            // ìƒíƒœëŠ” ì´ë²¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œë§Œ ì—…ë°ì´íŠ¸ (ìë™ ìƒˆë¡œê³ ì¹¨ ì œê±°)
            
            // ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.addEventListener('click', function(e) {
                // ê´€ë¦¬ ë²„íŠ¼ë“¤ í´ë¦­ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
                if (e.target.closest('.management-card, .btn, .nav-btn')) {
                    setTimeout(updateStatus, 100);
                }
            });
            
            // í¼ ì œì¶œ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.addEventListener('submit', function(e) {
                setTimeout(updateStatus, 100);
            });
            
            // í•´ì‹œ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            window.addEventListener('hashchange', handleHashChange);
            
            // í˜ì´ì§€ ë¡œë“œ ì‹œ í•´ì‹œ í™•ì¸
            setTimeout(() => {
                handleHashChange();
            }, 100);
            
            // í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ê°ì§€ (ì‚¬ìš©ìê°€ ë‹¤ë¥¸ íƒ­ìœ¼ë¡œ ê°”ë‹¤ê°€ ëŒì•„ì˜¬ ë•Œ)
            document.addEventListener('visibilitychange', async function() {
                if (!document.hidden) {
                    console.log('ğŸ“„ í˜ì´ì§€ê°€ ë‹¤ì‹œ í™œì„±í™”ë¨, localStorage ìƒíƒœ í™•ì¸');
                    const currentEmployeesData = localStorage.getItem('employees');
                    console.log('  ğŸ“ employees:', currentEmployeesData ? JSON.parse(currentEmployeesData).length + 'ëª…' : 'ì—†ìŒ');
                    
                    // í•­ìƒ ë‹¤ì‹œ ë Œë”ë§ (ì•ˆì •ì„± í–¥ìƒ)
                    console.log('ğŸ”„ í˜ì´ì§€ í™œì„±í™” ì‹œ ì§ì› ëª©ë¡ ì¬ë Œë”ë§');
                    await renderEmployeeList();
                    
                    // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë°±ì—…ì—ì„œ ë³µì› ì‹œë„
                    if (!currentEmployeesData || JSON.parse(currentEmployeesData).length === 0) {
                        console.log('âš ï¸ ì§ì› ë°ì´í„°ê°€ ì‚¬ë¼ì¡ŒìŒ, ë°±ì—…ì—ì„œ ë³µì› ì‹œë„');
                        
                        // ë°±ì—… ë°ì´í„° ì°¾ê¸°
                        const allKeys = Object.keys(localStorage);
                        const backupKeys = allKeys.filter(key => key.startsWith('employees_backup_')).sort().reverse();
                        
                        if (backupKeys.length > 0) {
                            const latestBackup = localStorage.getItem(backupKeys[0]);
                            if (latestBackup) {
                                localStorage.setItem('employees', latestBackup);
                                console.log('âœ… ë°±ì—…ì—ì„œ ë°ì´í„° ë³µì›:', backupKeys[0]);
                                await renderEmployeeList();
                            }
                        }
                    }
                }
            });
            
            // ì¶”ê°€: localStorage ë³€ê²½ ê°ì§€ (storage ì´ë²¤íŠ¸)
            window.addEventListener('storage', function(e) {
                if (e.key === 'employees' || (e.key && e.key.includes('employees'))) {
                    console.log('ğŸ”„ localStorage employees ë°ì´í„° ë³€ê²½ ê°ì§€, ì¬ë Œë”ë§');
                    setTimeout(async () => {
                        await renderEmployeeList();
                    }, 100);
                }
            });
            
            // ì£¼ê¸°ì  ë°ì´í„° ì§€ì†ì„± ì²´í¬ (10ì´ˆë§ˆë‹¤)
            setInterval(() => {
                ensureDataPersistence();
            }, 10000);
            
            // beforeunload ì´ë²¤íŠ¸ì—ì„œ localStorage í™•ì¸ ë° ë°±ì—…
            window.addEventListener('beforeunload', function() {
                console.log('ğŸšª í˜ì´ì§€ ì¢…ë£Œ ì „ ë°ì´í„° ë°±ì—…');
                const currentEmployees = localStorage.getItem('employees');
                if (currentEmployees) {
                    try {
                        const employees = JSON.parse(currentEmployees);
                        if (employees && employees.length > 0) {
                            createDataBackup(employees);
                            console.log('âœ… ì¢…ë£Œ ì „ ë°ì´í„° ë°±ì—… ì™„ë£Œ');
                        }
                    } catch (error) {
                        console.error('âŒ ì¢…ë£Œ ì „ ë°±ì—… ì‹¤íŒ¨:', error);
                    }
                }
            });
        });

        function hasAdminPermission(user) {
            const adminRoles = ['master', 'company_CEO', 'company_admin'];
            return adminRoles.includes(user.role);
        }

        // ì§ì› ê´€ë¦¬ ê¶Œí•œ ì²´í¬ (ë¡œì»¬ ì‚¬ìš©ì ì—­í• ë¡œë§Œ í™•ì¸, ë¬´í•œ ë£¨í”„ ë°©ì§€)
        async function canManageEmployees(user) {
            try {
                if (!user || !user.role) {
                    console.log('ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return false;
                }
                
                // ë¡œì»¬ ì‚¬ìš©ì ì •ë³´ì˜ ì—­í• ë¡œë§Œ í™•ì¸ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
                const managerRoles = ['master', 'company_CEO', 'company_admin'];
                const hasPermission = managerRoles.includes(user.role);
                
                console.log('ê¶Œí•œ í™•ì¸ ê²°ê³¼:', {
                    userRole: user.role,
                    hasPermission: hasPermission
                });
                
                return hasPermission;
            } catch (error) {
                console.error('ê¶Œí•œ í™•ì¸ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // ê¶Œí•œ ìˆ˜ì • ë¶ˆê°€ ì‚¬ìš©ì ì²´í¬
        function isSystemUser(role) {
            return ['master', 'company_CEO', 'company_admin'].includes(role);
        }

        // ê¶Œí•œ ì˜µì…˜ ì—…ë°ì´íŠ¸ (ê´€ë¦¬ì, ì§ì›ë§Œ)
        function updateRoleOptions(currentUser, employeeId = null) {
            const roleSelect = document.getElementById('employeeRole');
            
            // 4ê°€ì§€ ê¶Œí•œë§Œ ì„ íƒ ê°€ëŠ¥
            let options = '<option value="">ê¶Œí•œì„ ì„ íƒí•˜ì„¸ìš”</option>';
            options += '<option value="employee">ì§ì›</option>';
            options += '<option value="company_admin">íšŒì‚¬ ê´€ë¦¬ì</option>';
            options += '<option value="company_CEO">íšŒì‚¬ ëŒ€í‘œ</option>';
            
            // master ê¶Œí•œì€ ìµœê³  ê´€ë¦¬ìë§Œ ë¶€ì—¬ ê°€ëŠ¥
            if (currentUser.role === 'master') {
                options += '<option value="master">ë§ˆìŠ¤í„° ê´€ë¦¬ì</option>';
            }
            
            roleSelect.innerHTML = options;
        }

        // ì§ì› ëª©ë¡ ë Œë”ë§
        async function renderEmployeeList() {
            console.log('ğŸ”„ ì§ì› ëª©ë¡ ë Œë”ë§ ì‹œì‘');
            
            let employees = [];
            
            // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì› ëª©ë¡ ë¡œë“œ
            if (window.db && window.db.client) {
                try {
                    const { data, error } = await window.db.client
                        .from('users')
                        .select('*')
                        .eq('is_active', true)
                        .not('role', 'is', null)  // roleì´ ì„¤ì •ëœ ì‚¬ìš©ìë“¤ë§Œ (ìŠ¹ì¸ëœ ì‚¬ìš©ì)
                        .neq('role', 'master')    // masterëŠ” ì œì™¸
                        .order('name', { ascending: true });
                        
                    if (error) {
                        console.error('âŒ ì§ì› ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
                    } else {
                        employees = data || [];
                        console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì› ëª©ë¡ ë¡œë“œ ì™„ë£Œ:', employees.length, 'ëª… (master ì œì™¸)');
                    }
                } catch (error) {
                    console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ ì˜ˆì™¸:', error);
                }
            }
            
            // ë°±ì—…ìœ¼ë¡œ localStorageì—ì„œ ê°€ì ¸ì˜¤ê¸° (master ì œì™¸)
            if (employees.length === 0) {
                const allEmployees = JSON.parse(localStorage.getItem('employees') || '[]');
                employees = allEmployees.filter(emp => emp.role !== 'master');
                console.log('ğŸ“‚ localStorageì—ì„œ ì§ì› ë°ì´í„° ë°±ì—… ë¡œë“œ:', employees.length, 'ëª… (master ì œì™¸)');
            }
            
            const employeeList = document.getElementById('employeeList');
            const currentUser = AuthManager.getCurrentUser();
            
            console.log('ğŸ‘¥ í‘œì‹œí•  ì§ì› ìˆ˜:', employees.length);
            console.log('ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì:', currentUser);
            
            // ì§ì› ë°ì´í„°ê°€ ìˆëŠ”ì§€ ë” ìì„¸íˆ í™•ì¸
            if (employees.length > 0) {
                console.log('ğŸ“‹ ì§ì› ëª©ë¡ ìƒ˜í”Œ:', employees.slice(0, 3).map(emp => ({ 
                    id: emp.id, 
                    name: emp.name, 
                    companyId: emp.companyId,
                    createdAt: emp.createdAt 
                })));
            }
            
            if (employees.length === 0) {
                employeeList.innerHTML = '<p style="text-align: center; color: #9ca3af;">ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            const htmlContent = employees.map(emp => {
                const isSystemUser = ['master', 'company_admin'].includes(emp.role);
                const canEdit = canManageEmployees(currentUser) && (!isSystemUser || currentUser.role === 'master');
                const canDelete = canManageEmployees(currentUser) && !isSystemUser;
                
                console.log(`ğŸ‘¤ ${emp.name}: canEdit=${canEdit}, canDelete=${canDelete}, isSystemUser=${isSystemUser}`);
                
                return `
                    <div class="employee-card" data-employee-id="${emp.id}">
                        <div class="employee-info">
                            <h4>${emp.name} ${isSystemUser ? '<i class="fas fa-shield-alt" style="color: #f59e0b; margin-left: 0.5rem;" title="ì‹œìŠ¤í…œ ì‚¬ìš©ì"></i>' : ''}</h4>
                            <p>${emp.email}</p>
                            <p>${emp.department || 'ë¯¸ì„¤ì •'} | ${emp.position || 'ë¯¸ì„¤ì •'}</p>
                            <span class="role-badge role-${emp.role}">${getRoleText(emp.role)}</span>
                        </div>
                        <div class="employee-actions">
                            ${canEdit ? `
                                <button type="button" class="btn btn-small edit-employee-btn" data-employee-id="${emp.id}" onclick="console.log('ğŸ“ ìˆ˜ì • ë²„íŠ¼ í´ë¦­: ${emp.id}'); try { window.simpleEditEmployee('${emp.id}'); } catch(e) { console.error('ìˆ˜ì • ì˜¤ë¥˜:', e); alert('ìˆ˜ì • ì˜¤ë¥˜: ' + e.message); } return false;">
                                    <i class="fas fa-edit"></i> ìˆ˜ì •
                                </button>
                            ` : ''}
                            ${canDelete ? `
                                <button type="button" class="btn btn-small btn-danger delete-employee-btn" data-employee-id="${emp.id}" onclick="console.log('ğŸ—‘ï¸ ì‚­ì œ ë²„íŠ¼ í´ë¦­: ${emp.id}'); window.deleteEmployee('${emp.id}'); return false;">
                                    <i class="fas fa-trash"></i> ì‚­ì œ
                                </button>
                            ` : ''}
                            ${!canEdit && !canDelete ? `
                                <span style="color: #6b7280; font-size: 0.8rem;">ê¶Œí•œ ì—†ìŒ</span>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            employeeList.innerHTML = htmlContent;
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (onclick ë°±ì—…ìš©)
            setTimeout(() => {
                // ìˆ˜ì • ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                const editButtons = document.querySelectorAll('.edit-employee-btn');
                console.log('ğŸ“ ìˆ˜ì • ë²„íŠ¼ ì°¾ìŒ:', editButtons.length);
                
                editButtons.forEach((btn, index) => {
                    console.log(`ìˆ˜ì • ë²„íŠ¼ ${index}:`, btn.getAttribute('data-employee-id'));
                    
                    // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                    btn.removeEventListener('click', handleEditClick);
                    
                    // ìƒˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                    btn.addEventListener('click', handleEditClick);
                });
                
                // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                const deleteButtons = document.querySelectorAll('.delete-employee-btn');
                console.log('ğŸ—‘ï¸ ì‚­ì œ ë²„íŠ¼ ì°¾ìŒ:', deleteButtons.length);
                
                deleteButtons.forEach((btn, index) => {
                    console.log(`ì‚­ì œ ë²„íŠ¼ ${index}:`, btn.getAttribute('data-employee-id'));
                    
                    // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                    btn.removeEventListener('click', handleDeleteClick);
                    
                    // ìƒˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                    btn.addEventListener('click', handleDeleteClick);
                });
                
                console.log('âœ… ì§ì› ëª©ë¡ ë Œë”ë§ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
            }, 100);
        }

        // ë°ì´í„° ë°±ì—… ë° ë³µì› ì‹œìŠ¤í…œ
        function createDataBackup(employees) {
            try {
                const timestamp = Date.now();
                const backupKey = `employees_backup_${timestamp}`;
                localStorage.setItem(backupKey, JSON.stringify(employees));
                console.log('ğŸ’¾ ë°ì´í„° ë°±ì—… ìƒì„±:', backupKey);
                
                // ì˜¤ë˜ëœ ë°±ì—… ì •ë¦¬ (ìµœê·¼ 10ê°œë§Œ ìœ ì§€)
                const allKeys = Object.keys(localStorage);
                const backupKeys = allKeys.filter(key => key.startsWith('employees_backup_')).sort();
                if (backupKeys.length > 10) {
                    const keysToRemove = backupKeys.slice(0, backupKeys.length - 10);
                    keysToRemove.forEach(key => {
                        localStorage.removeItem(key);
                        console.log('ğŸ—‘ï¸ ì˜¤ë˜ëœ ë°±ì—… ì œê±°:', key);
                    });
                }
            } catch (error) {
                console.error('âŒ ë°±ì—… ìƒì„± ì‹¤íŒ¨:', error);
            }
        }
        
        function restoreFromBackup() {
            try {
                const allKeys = Object.keys(localStorage);
                const backupKeys = allKeys.filter(key => key.startsWith('employees_backup_')).sort().reverse();
                
                if (backupKeys.length > 0) {
                    const latestBackup = localStorage.getItem(backupKeys[0]);
                    if (latestBackup) {
                        const employees = JSON.parse(latestBackup);
                        localStorage.setItem('employees', latestBackup);
                        console.log('âœ… ë°±ì—…ì—ì„œ ë°ì´í„° ë³µì›:', backupKeys[0], employees.length + 'ëª…');
                        return employees;
                    }
                }
            } catch (error) {
                console.error('âŒ ë°±ì—… ë³µì› ì‹¤íŒ¨:', error);
            }
            return null;
        }
        
        function ensureDataPersistence() {
            // ë°ì´í„° ì§€ì†ì„± ë³´ì¥ì„ ìœ„í•œ ì£¼ê¸°ì  ì²´í¬
            const currentData = localStorage.getItem('employees');
            if (!currentData || JSON.parse(currentData).length === 0) {
                console.log('âš ï¸ ì§ì› ë°ì´í„° ì†ì‹¤ ê°ì§€, ë³µì› ì‹œë„');
                const restored = restoreFromBackup();
                if (!restored) {
                    console.log('âš ï¸ ë°±ì—…ë„ ì—†ìŒ, ì´ˆê¸°í™” ì‹¤í–‰');
                    loadEmployeesFromDatabase();
                }
                renderEmployeeList();
            }
        }

        // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì› ë°ì´í„° ë¡œë“œ
        async function loadEmployeesFromDatabase() {
            console.log('ğŸ”„ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì› ë°ì´í„° ë¡œë”© ì‹œì‘');
            
            try {
                // DatabaseManager ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš©
                if (typeof databaseManager !== 'undefined' && databaseManager.getEmployees) {
                    const employees = await databaseManager.getEmployees();
                    
                    if (employees && employees.length > 0) {
                        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ìºì‹œ
                        localStorage.setItem('employees', JSON.stringify(employees));
                        
                        // íšŒì‚¬ë³„ ë°ì´í„°ë„ ì—…ë°ì´íŠ¸
                        const companyEmployees = employees.filter(emp => emp.companyId === 'seokyoung-snt');
                        localStorage.setItem('company_seokyoung-snt_employees', JSON.stringify(companyEmployees));
                        
                        console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì› ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', employees.length + 'ëª…');
                        
                        // ë°ì´í„° ë°±ì—… ìƒì„±
                        createDataBackup(employees);
                        
                        // ì¦‰ì‹œ ë Œë”ë§
                        renderEmployeeList();
                        
                        return employees;
                    }
                }
            } catch (error) {
                console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
            
            // ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œë“œ
            const localEmployees = JSON.parse(localStorage.getItem('employees') || '[]');
            console.log('ğŸ“‚ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì§ì› ë°ì´í„° ë¡œë“œ:', localEmployees.length + 'ëª…');
            renderEmployeeList();
            return localEmployees;
        }
        
        // ê¸°ì¡´ initializeTestEmployees í•¨ìˆ˜ëŠ” ì œê±°í•˜ê³  loadEmployeesFromDatabase ì‚¬ìš©

        function getTemplateName(templateId) {
            const names = {
                'scout': 'í•œêµ­ì² ê°•',
                'instant': 'ëŒ€í•œì² ê°•',
                'visible': 'ë¹„ì „ìŠ¤í‹¸',
                'dewi': 'ë™ì–‘ì² ê°•',
                'nice-restaurant': 'í•œì¼ì² ê°•',
                'iportfolio': 'í¬í•­ì² ê°•',
                'blogy': 'í•œêµ­ì‚°ì—…',
                'gp': 'ê¸€ë¡œë²Œì² ê°•',
                'upconstruction': 'ëŒ€í•œì¤‘ê³µì—…'
            };
            return names[templateId] || templateId;
        }

        function setupEventListeners() {
            // íƒ­ ì „í™˜
            document.querySelectorAll('.nav-btn[data-section]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });

            // ì§ì› í¼ ì œì¶œ - null ì²´í¬ ì¶”ê°€
            const employeeForm = document.getElementById('employeeForm');
            if (employeeForm) {
                employeeForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveEmployee();
                });
            }

        }

        function switchSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-btn[data-section]').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            const targetBtn = document.querySelector(`[data-section="${sectionId}"]`);
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
        }

        function loadData() {
            loadEmployees();
        }

        // ì§ì› ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function loadEmployees() {
            console.log('ğŸ“‚ loadEmployees í˜¸ì¶œë¨');
            const currentData = localStorage.getItem('employees');
            console.log('  ğŸ“ í˜„ì¬ employees ë°ì´í„°:', currentData ? JSON.parse(currentData).length + 'ëª…' : 'ì—†ìŒ');
            renderEmployeeList();
        }

        function getRoleText(role) {
            const roleTexts = {
                'employee': 'ì§ì›',
                'manager': 'ë§¤ë‹ˆì €',
                'company_admin': 'íšŒì‚¬ ê´€ë¦¬ì',
                'master': 'ë§ˆìŠ¤í„°'
            };
            return roleTexts[role] || role;
        }

        function openEmployeeModal(employeeId = null) {
            console.log('ğŸ”µ openEmployeeModal í˜¸ì¶œë¨. employeeId:', employeeId);
            
            try {
                const currentUser = AuthManager.getCurrentUser();
                console.log('ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì:', currentUser);
                
                // ê¶Œí•œ ì²´í¬
                if (!canManageEmployees(currentUser)) {
                    alert('ì§ì› ê´€ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                    console.log('âŒ ê¶Œí•œ ì²´í¬ ì‹¤íŒ¨');
                    return;
                }
                
                console.log('âœ… ê¶Œí•œ ì²´í¬ í†µê³¼');
                
                currentEditingEmployee = employeeId;
                const modal = document.getElementById('employeeModal');
                const form = document.getElementById('employeeForm');
                
                console.log('ğŸ¯ ëª¨ë‹¬ ìš”ì†Œ:', modal);
                console.log('ğŸ“ í¼ ìš”ì†Œ:', form);
                
                if (!modal) {
                    console.error('âŒ ëª¨ë‹¬ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    alert('ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                if (!form) {
                    console.error('âŒ í¼ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    alert('í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ëª¨ë‹¬ í‘œì‹œ
                modal.style.display = 'flex';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                console.log('ğŸ“– ëª¨ë‹¬ í‘œì‹œë¨');
                
                // í¼ ì´ˆê¸°í™”
                form.reset();
                console.log('ğŸ”„ í¼ ì´ˆê¸°í™” ì™„ë£Œ');
                
                // ê¶Œí•œ ì˜µì…˜ ì„¤ì • (í¼ ë¦¬ì…‹ í›„)
                try {
                    updateRoleOptions(currentUser, employeeId);
                    console.log('âš™ï¸ ê¶Œí•œ ì˜µì…˜ ì„¤ì • ì™„ë£Œ');
                } catch (error) {
                    console.error('âŒ ê¶Œí•œ ì˜µì…˜ ì„¤ì • ì‹¤íŒ¨:', error);
                }
                
                // ë¶€ì„œ ë° ì§ì±… ì˜µì…˜ ì—…ë°ì´íŠ¸ (ë³„ë„ë¡œ ì²˜ë¦¬)
                setTimeout(() => {
                    try {
                        updateEmployeeFormOptions();
                        console.log('âš™ï¸ ë¶€ì„œ/ì§ì±… ì˜µì…˜ ì„¤ì • ì™„ë£Œ');
                        
                        // ì˜µì…˜ ë¡œë“œ í™•ì¸
                        const deptSelect = document.getElementById('employeeDepartment');
                        const posSelect = document.getElementById('employeePosition');
                        console.log('ğŸ” ë¶€ì„œ/ì§ì±… ì˜µì…˜ í™•ì¸:', {
                            deptOptions: deptSelect ? deptSelect.options.length : 0,
                            posOptions: posSelect ? posSelect.options.length : 0
                        });
                    } catch (error) {
                        console.error('âŒ ë¶€ì„œ/ì§ì±… ì˜µì…˜ ì„¤ì • ì‹¤íŒ¨:', error);
                    }
                }, 100);
                
                if (employeeId) {
                    console.log('ğŸ“ ì§ì› ìˆ˜ì • ëª¨ë“œ');
                    
                    // í˜„ì¬ íšŒì‚¬ ID ê°€ì ¸ì˜¤ê¸°
                    const urlParams = new URLSearchParams(window.location.search);
                    const companyId = urlParams.get('company');
                    
                    let employee = null;
                    
                    // ë¨¼ì € íšŒì‚¬ë³„ ì§ì› ëª©ë¡ì—ì„œ ì°¾ê¸°
                    if (companyId) {
                        const companyKey = `company_${companyId}_employees`;
                        const companyEmployees = JSON.parse(localStorage.getItem(companyKey) || '[]');
                        employee = companyEmployees.find(emp => emp.id === employeeId);
                    }
                    
                    // íšŒì‚¬ë³„ ëª©ë¡ì— ì—†ìœ¼ë©´ í†µí•© ëª©ë¡ì—ì„œ ì°¾ê¸°
                    if (!employee) {
                        const allEmployees = JSON.parse(localStorage.getItem('employees') || '[]');
                        employee = allEmployees.find(emp => emp.id === employeeId);
                    }
                    
                    console.log('ğŸ‘¤ ìˆ˜ì •í•  ì§ì›:', employee);
                    
                    if (employee) {
                        console.log('ğŸ“ ì§ì› ìˆ˜ì • ëª¨ë“œ - ê¸°ì¡´ ë°ì´í„° ë¡œë“œ:', employee);
                        
                        // ì¦‰ì‹œ ê°’ ì„¤ì • (setTimeout ì œê±°)
                        const nameEl = document.getElementById('employeeName');
                        const emailEl = document.getElementById('employeeEmail');
                        const deptEl = document.getElementById('employeeDepartment');
                        const posEl = document.getElementById('employeePosition');
                        const phoneEl = document.getElementById('employeePhone');
                        const roleEl = document.getElementById('employeeRole');
                        
                        console.log('ğŸ” ëª¨ë‹¬ ìš”ì†Œë“¤:', {
                            nameEl: !!nameEl,
                            emailEl: !!emailEl,
                            deptEl: !!deptEl,
                            posEl: !!posEl,
                            phoneEl: !!phoneEl,
                            roleEl: !!roleEl
                        });
                        
                        if (nameEl) {
                            nameEl.value = employee.name || '';
                            console.log('âœ… ì´ë¦„ ì„¤ì •:', nameEl.value);
                        }
                        if (emailEl) {
                            emailEl.value = employee.email || '';
                            console.log('âœ… ì´ë©”ì¼ ì„¤ì •:', emailEl.value);
                        }
                        if (deptEl) {
                            deptEl.value = employee.department || '';
                            console.log('âœ… ë¶€ì„œ ì„¤ì •:', deptEl.value);
                        }
                        if (posEl) {
                            posEl.value = employee.position || '';
                            console.log('âœ… ì§ì±… ì„¤ì •:', posEl.value);
                        }
                        if (phoneEl) {
                            phoneEl.value = employee.phone || '';
                            console.log('âœ… ì—°ë½ì²˜ ì„¤ì •:', phoneEl.value);
                        }
                        if (roleEl) {
                            roleEl.value = employee.role || '';
                            console.log('âœ… ê¶Œí•œ ì„¤ì •:', roleEl.value);
                        }
                        
                        // ì‹œìŠ¤í…œ ì‚¬ìš©ìì¸ ê²½ìš° ê¶Œí•œ í•„ë“œ ë¹„í™œì„±í™”
                        if (roleEl && isSystemUser(employee.role) && currentUser.role !== 'master') {
                            roleEl.disabled = true;
                            console.log('ğŸ”’ ê¶Œí•œ í•„ë“œ ë¹„í™œì„±í™” (ì‹œìŠ¤í…œ ì‚¬ìš©ì)');
                        } else if (roleEl) {
                            roleEl.disabled = false;
                            console.log('ğŸ”“ ê¶Œí•œ í•„ë“œ í™œì„±í™”');
                        }
                        
                        console.log('âœ… ì§ì› ì •ë³´ ë¡œë“œ ì™„ë£Œ');
                    } else {
                        console.log('âš ï¸ ì§ì› ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ!');
                    }
                } else {
                    console.log('â• ì§ì› ì¶”ê°€ ëª¨ë“œ');
                    const roleEl = document.getElementById('employeeRole');
                    if (roleEl) roleEl.disabled = false;
                }
                
                console.log('ğŸ‰ ëª¨ë‹¬ ì—´ê¸° ì™„ë£Œ');
                
                // ëª¨ë‹¬ ì™„ì „ ë¡œë“œ í›„ í¼ ìš”ì†Œ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸
                setTimeout(() => {
                    console.log('ğŸ§ª í¼ ìš”ì†Œ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸ ì‹œì‘');
                    testFormElementsAccessibility();
                }, 200);
                
            } catch (error) {
                console.error('âŒ openEmployeeModal ì˜¤ë¥˜:', error);
                alert('ëª¨ë‹¬ì„ ì—¬ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // í¼ ìš”ì†Œ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        function testFormElementsAccessibility() {
            const elements = {
                name: document.getElementById('employeeName'),
                email: document.getElementById('employeeEmail'),
                role: document.getElementById('employeeRole'),
                department: document.getElementById('employeeDepartment'),
                position: document.getElementById('employeePosition'),
                phone: document.getElementById('employeePhone')
            };
            
            console.log('ğŸ§ª í¼ ìš”ì†Œ í…ŒìŠ¤íŠ¸ ê²°ê³¼:');
            
            for (const [key, element] of Object.entries(elements)) {
                if (element) {
                    console.log(`  âœ… ${key}: ì ‘ê·¼ ê°€ëŠ¥, íƒ€ì…: ${element.tagName}, ê°’: "${element.value}"`);
                    if (element.tagName === 'SELECT') {
                        console.log(`    ì˜µì…˜ ìˆ˜: ${element.options.length}`);
                    }
                } else {
                    console.error(`  âŒ ${key}: ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                }
            }
            
            // ëª¨ë‹¬ í‘œì‹œ ìƒíƒœ í™•ì¸
            const modal = document.getElementById('employeeModal');
            console.log('ğŸ­ ëª¨ë‹¬ í‘œì‹œ ìƒíƒœ:', {
                display: modal?.style.display,
                offsetParent: modal?.offsetParent !== null,
                clientWidth: modal?.clientWidth,
                clientHeight: modal?.clientHeight
            });
        }

        function closeEmployeeModal() {
            console.log('âŒ ì§ì› ëª¨ë‹¬ ë‹«ê¸°');
            const modal = document.getElementById('employeeModal');
            modal.style.display = 'none';
            
            // í¼ ì´ˆê¸°í™”
            const form = document.getElementById('employeeForm');
            if (form) {
                form.reset();
            }
            
            // ê¶Œí•œ ì„ íƒ í•„ë“œ í™œì„±í™”
            const roleSelect = document.getElementById('employeeRole');
            if (roleSelect) {
                roleSelect.disabled = false;
            }
            
            // currentEditingEmployeeëŠ” saveEmployee ì™„ë£Œ í›„ì—ë§Œ ì´ˆê¸°í™”
            // currentEditingEmployee = null; // ì´ ë¼ì¸ì„ ì œê±°í•˜ì—¬ ì €ì¥ ì¤‘ ê°’ì´ ìœ ì§€ë˜ë„ë¡ í•¨
        }

        // ì €ì¥ ì¤‘ í”Œë˜ê·¸ (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€)
        let isSaving = false;
        
        function saveEmployee() {
            console.log('ğŸ’¾ saveEmployee í•¨ìˆ˜ ì‹œì‘');
            
            // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
            if (isSaving) {
                console.log('âš ï¸ ì´ë¯¸ ì €ì¥ ì¤‘ì…ë‹ˆë‹¤. ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€');
                return;
            }
            
            isSaving = true;
            console.log('ğŸ”’ ì €ì¥ í”Œë˜ê·¸ ì„¤ì •ë¨');
            
            const currentUser = AuthManager.getCurrentUser();
            
            // ê¶Œí•œ ì²´í¬
            if (!canManageEmployees(currentUser)) {
                alert('ì§ì› ê´€ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                isSaving = false; // í”Œë˜ê·¸ í•´ì œ
                return;
            }
            
            // ëª¨ë‹¬ì´ í‘œì‹œë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            const modal = document.getElementById('employeeModal');
            console.log('ğŸ­ ëª¨ë‹¬ ìƒíƒœ:', {
                modalExists: !!modal,
                modalDisplay: modal ? modal.style.display : 'N/A',
                modalVisible: modal ? modal.offsetParent !== null : false
            });
            
            // ëª¨ë‹¬ì´ ë‹«í˜€ìˆìœ¼ë©´ ì €ì¥í•˜ì§€ ì•ŠìŒ
            if (!modal || modal.style.display === 'none') {
                console.log('âš ï¸ ëª¨ë‹¬ì´ ë‹«í˜€ìˆì–´ì„œ ì €ì¥ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.');
                isSaving = false; // í”Œë˜ê·¸ í•´ì œ
                return;
            }
            
            // DOM ìš”ì†Œë“¤ì´ ì¡´ì¬í•˜ëŠ”ì§€ ë¨¼ì € í™•ì¸
            const nameElement = document.getElementById('employeeName');
            const emailElement = document.getElementById('employeeEmail');
            const roleElement = document.getElementById('employeeRole');
            const departmentElement = document.getElementById('employeeDepartment');
            const positionElement = document.getElementById('employeePosition');
            const phoneElement = document.getElementById('employeePhone');
            
            console.log('ğŸ” DOM ìš”ì†Œ ì¡´ì¬ í™•ì¸:', {
                nameElement: !!nameElement,
                emailElement: !!emailElement,
                roleElement: !!roleElement,
                departmentElement: !!departmentElement,
                positionElement: !!positionElement,
                phoneElement: !!phoneElement
            });
            
            // ìš”ì†Œê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ê²½ê³ 
            if (!nameElement || !emailElement || !roleElement) {
                console.error('âŒ í•„ìˆ˜ DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                alert('í¼ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                isSaving = false; // í”Œë˜ê·¸ í•´ì œ
                return;
            }
            
            // ì‹¤ì œ ê°’ ì½ê¸°
            const name = nameElement.value.trim();
            const email = emailElement.value.trim();
            const role = roleElement.value;
            const department = departmentElement ? departmentElement.value.trim() : '';
            const position = positionElement ? positionElement.value.trim() : '';
            const phone = phoneElement ? phoneElement.value.trim() : '';
            
            console.log('ğŸ“ ì…ë ¥ëœ ì§ì› ì •ë³´:', { name, email, role, department, position, phone });
            
            // HTML ê°’ë„ í™•ì¸ (ë””ë²„ê¹…ìš©)
            console.log('ğŸ” HTML input ê°’ ì§ì ‘ í™•ì¸:', {
                nameHTML: nameElement.outerHTML,
                emailHTML: emailElement.outerHTML,
                roleHTML: roleElement.outerHTML
            });
            
            // ë” ì •í™•í•œ í•„ìˆ˜ í•­ëª© ê²€ì¦
            console.log('ğŸ” í•„ìˆ˜ í•­ëª© ê²€ì¦:', { 
                name: name || 'empty', 
                email: email || 'empty', 
                role: role || 'empty',
                nameLength: name.length,
                emailLength: email.length,
                roleValue: role,
                department: department || 'empty',
                position: position || 'empty'
            });
            
            // í•„ìˆ˜ í•­ëª©ë“¤ì„ ê°œë³„ì ìœ¼ë¡œ í™•ì¸
            const validationErrors = [];
            
            if (!name || name.length === 0) {
                validationErrors.push('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                console.log('âŒ ì´ë¦„ ëˆ„ë½:', name);
            }
            
            if (!email || email.length === 0) {
                validationErrors.push('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                console.log('âŒ ì´ë©”ì¼ ëˆ„ë½:', email);
            }
            
            if (!role || role === '' || role === null || role === undefined) {
                validationErrors.push('ê¶Œí•œì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                console.log('âŒ ê¶Œí•œ ëˆ„ë½, role ê°’:', role);
            }
            
            // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
            if (email && email.length > 0) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    validationErrors.push('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    console.log('âŒ ì´ë©”ì¼ í˜•ì‹ ì˜¤ë¥˜:', email);
                }
            }
            
            // ê²€ì¦ ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ í‘œì‹œ
            if (validationErrors.length > 0) {
                const errorMessage = validationErrors.join('\n');
                alert(errorMessage);
                console.log('âŒ ê²€ì¦ ì‹¤íŒ¨:', validationErrors);
                isSaving = false; // í”Œë˜ê·¸ í•´ì œ
                return;
            }
            
            console.log('âœ… ëª¨ë“  í•„ìˆ˜ í•­ëª© í†µê³¼');
            
            // í˜„ì¬ íšŒì‚¬ ID ê°€ì ¸ì˜¤ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company');
            console.log('ğŸ¢ í˜„ì¬ íšŒì‚¬ ID:', companyId);
            
            // ì €ì¥ ì „ í˜„ì¬ localStorage ìƒíƒœ ë¡œê¹…
            console.log('ğŸ” ì €ì¥ ì „ localStorage ìƒíƒœ:');
            if (companyId) {
                const companyKey = `company_${companyId}_employees`;
                const existingCompanyData = localStorage.getItem(companyKey);
                console.log(`  ğŸ“ ${companyKey}:`, existingCompanyData ? JSON.parse(existingCompanyData).length + 'ëª…' : 'ì—†ìŒ');
            }
            const existingAllData = localStorage.getItem('employees');
            console.log('  ğŸ“ employees:', existingAllData ? JSON.parse(existingAllData).length + 'ëª…' : 'ì—†ìŒ');
            
            // íšŒì‚¬ë³„ ì§ì› ëª©ë¡ê³¼ í†µí•© ëª©ë¡ ëª¨ë‘ ê°€ì ¸ì˜¤ê¸°
            let companyEmployees = [];
            if (companyId) {
                const companyKey = `company_${companyId}_employees`;
                companyEmployees = JSON.parse(localStorage.getItem(companyKey) || '[]');
                console.log('ğŸ“‹ ê¸°ì¡´ íšŒì‚¬ë³„ ì§ì› ìˆ˜:', companyEmployees.length);
            }
            const allEmployees = JSON.parse(localStorage.getItem('employees') || '[]');
            console.log('ğŸ“‹ ê¸°ì¡´ í†µí•© ì§ì› ìˆ˜:', allEmployees.length);
            
            if (currentEditingEmployee) {
                console.log('âœï¸ ì§ì› ìˆ˜ì • ëª¨ë“œ, ID:', currentEditingEmployee);
                // ìˆ˜ì • ëª¨ë“œ
                // íšŒì‚¬ë³„ ëª©ë¡ì—ì„œ ì°¾ê¸°
                const companyIndex = companyEmployees.findIndex(emp => emp.id === currentEditingEmployee);
                const allIndex = allEmployees.findIndex(emp => emp.id === currentEditingEmployee);
                
                console.log('ğŸ” ì¸ë±ìŠ¤ ì°¾ê¸° ê²°ê³¼:', { companyIndex, allIndex });
                
                // ì›ë³¸ ì§ì› ì •ë³´ ì°¾ê¸° (íšŒì‚¬ë³„ ìš°ì„ , ì—†ìœ¼ë©´ í†µí•©ì—ì„œ)
                let originalEmployee = null;
                if (companyIndex !== -1) {
                    originalEmployee = companyEmployees[companyIndex];
                } else if (allIndex !== -1) {
                    originalEmployee = allEmployees[allIndex];
                }
                
                if (originalEmployee) {
                    // ì‹œìŠ¤í…œ ì‚¬ìš©ì ê¶Œí•œ ë³€ê²½ ì²´í¬
                    if (isSystemUser(originalEmployee.role) && currentUser.role !== 'master') {
                        alert('ë§ˆìŠ¤í„°ë§Œ ì‹œìŠ¤í…œ ì‚¬ìš©ìì˜ ê¶Œí•œì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        isSaving = false;
                        return;
                    }
                    
                    // ìƒˆë¡œìš´ ê¶Œí•œì´ ì‹œìŠ¤í…œ ê¶Œí•œì¸ì§€ ì²´í¬
                    if (isSystemUser(role) && currentUser.role !== 'master') {
                        alert('ë§ˆìŠ¤í„°ë§Œ ì‹œìŠ¤í…œ ê¶Œí•œ(ë§ˆìŠ¤í„°, íšŒì‚¬ëŒ€í‘œ)ì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        isSaving = false;
                        return;
                    }
                    
                    const updatedEmployee = {
                        ...originalEmployee,
                        name,
                        email,
                        role,
                        department,
                        position,
                        phone,
                        updatedAt: new Date().toISOString()
                    };
                    
                    console.log('âœï¸ ì—…ë°ì´íŠ¸ëœ ì§ì› ì •ë³´:', updatedEmployee);
                    
                    // íšŒì‚¬ë³„ ëª©ë¡ ì—…ë°ì´íŠ¸
                    if (companyIndex !== -1) {
                        companyEmployees[companyIndex] = updatedEmployee;
                    } else if (companyId && originalEmployee.companyId === companyId) {
                        // íšŒì‚¬ë³„ ëª©ë¡ì— ì—†ì§€ë§Œ ê°™ì€ íšŒì‚¬ ì§ì›ì´ë©´ ì¶”ê°€
                        companyEmployees.push(updatedEmployee);
                    }
                    
                    // í†µí•© ëª©ë¡ ì—…ë°ì´íŠ¸
                    if (allIndex !== -1) {
                        allEmployees[allIndex] = updatedEmployee;
                    }
                } else {
                    console.error('âŒ ìˆ˜ì •í•  ì§ì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    alert('ìˆ˜ì •í•  ì§ì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    isSaving = false;
                    return;
                }
            } else {
                console.log('â• ì§ì› ì¶”ê°€ ëª¨ë“œ');
                // ìƒˆ ì§ì› ì¶”ê°€
                // ì‹œìŠ¤í…œ ê¶Œí•œ ë¶€ì—¬ ì²´í¬
                if (isSystemUser(role) && currentUser.role !== 'master') {
                    alert('ë§ˆìŠ¤í„°ë§Œ ì‹œìŠ¤í…œ ê¶Œí•œ(ë§ˆìŠ¤í„°, íšŒì‚¬ëŒ€í‘œ)ì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const newEmployee = {
                    id: Date.now().toString(),
                    name,
                    email,
                    role,
                    department,
                    position,
                    phone,
                    companyId: companyId, // íšŒì‚¬ ID ì¶”ê°€
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                console.log('â• ìƒˆ ì§ì› ì •ë³´:', newEmployee);
                
                // íšŒì‚¬ë³„ ëª©ë¡ì— ì¶”ê°€
                if (companyId) {
                    companyEmployees.push(newEmployee);
                    console.log('ğŸ“ íšŒì‚¬ë³„ ëª©ë¡ì— ì¶”ê°€ ì™„ë£Œ, ì´ ì¸ì›:', companyEmployees.length);
                }
                
                // í†µí•© ëª©ë¡ì— ì¶”ê°€
                allEmployees.push(newEmployee);
                console.log('ğŸ“ í†µí•© ëª©ë¡ì— ì¶”ê°€ ì™„ë£Œ, ì´ ì¸ì›:', allEmployees.length);
            }
            
            // ì €ì¥ ì „ ìµœì¢… í™•ì¸
            console.log('ğŸ’¾ ì €ì¥í•  ë°ì´í„° í™•ì¸:');
            console.log('  íšŒì‚¬ë³„ ì§ì› ìˆ˜:', companyEmployees.length);
            console.log('  í†µí•© ì§ì› ìˆ˜:', allEmployees.length);
            
            // ì €ì¥
            try {
                if (companyId) {
                    const companyKey = `company_${companyId}_employees`;
                    const companyDataStr = JSON.stringify(companyEmployees);
                    localStorage.setItem(companyKey, companyDataStr);
                    console.log('ğŸ’¾ íšŒì‚¬ë³„ ì§ì› ë°ì´í„° ì €ì¥ ì™„ë£Œ:', companyKey, companyEmployees.length + 'ëª…');
                    
                    // ì¦‰ì‹œ í™•ì¸
                    const verifyCompanyData = localStorage.getItem(companyKey);
                    if (verifyCompanyData) {
                        const parsed = JSON.parse(verifyCompanyData);
                        console.log('âœ… íšŒì‚¬ë³„ ë°ì´í„° ì €ì¥ í™•ì¸:', parsed.length + 'ëª…');
                    } else {
                        console.error('âŒ íšŒì‚¬ë³„ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨!');
                    }
                }
                
                const allDataStr = JSON.stringify(allEmployees);
                localStorage.setItem('employees', allDataStr);
                console.log('ğŸ’¾ í†µí•© ì§ì› ë°ì´í„° ì €ì¥ ì™„ë£Œ:', allEmployees.length + 'ëª…');
                
                // ë°ì´í„° ë³€ê²½ ì‹œ ë°±ì—… ìƒì„±
                createDataBackup(allEmployees);
                
                // ì¦‰ì‹œ í™•ì¸
                const verifyAllData = localStorage.getItem('employees');
                if (verifyAllData) {
                    const parsed = JSON.parse(verifyAllData);
                    console.log('âœ… í†µí•© ë°ì´í„° ì €ì¥ í™•ì¸:', parsed.length + 'ëª…');
                    
                    // ì €ì¥ëœ ì§ì› ëª©ë¡ì˜ ì²˜ìŒ 3ëª… í™•ì¸
                    console.log('ğŸ“‹ ì €ì¥ëœ ì§ì› ìƒ˜í”Œ:', parsed.slice(0, 3).map(emp => ({ id: emp.id, name: emp.name, companyId: emp.companyId })));
                } else {
                    console.error('âŒ í†µí•© ë°ì´í„° ì €ì¥ ì‹¤íŒ¨!');
                }
                
            } catch (error) {
                console.error('âŒ localStorage ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì§ì› ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                isSaving = false; // í”Œë˜ê·¸ í•´ì œ
                return;
            }
            
            // localStorage ë°ì´í„° ë³´ì¡´ì„ ìœ„í•œ ì¶”ê°€ ì €ì¥ (ë¨¼ì € ì‹¤í–‰)
            const finalDataBackup = JSON.parse(localStorage.getItem('employees') || '[]');
            console.log('ğŸ”’ ìµœì¢… ë°ì´í„° ë°±ì—…:', finalDataBackup.length + 'ëª…');
            
            // ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œì— ì§ì› ìˆ˜ ë™ê¸°í™” (ë Œë”ë§ ì „ì— ì‹¤í–‰)
            if (typeof window.syncEmployeeCount === 'function') {
                window.syncEmployeeCount(companyId);
                console.log('ğŸ”„ ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œì— ì§ì› ìˆ˜ ë™ê¸°í™”');
            }
            
            // ë°ì´í„° ë³µì› í™•ì¸ ë° ì¬ì €ì¥
            setTimeout(() => {
                const currentData = JSON.parse(localStorage.getItem('employees') || '[]');
                console.log('ğŸ” ë™ê¸°í™” í›„ ë°ì´í„° í™•ì¸:', currentData.length + 'ëª…');
                
                if (currentData.length < finalDataBackup.length) {
                    console.log('âš ï¸ ë°ì´í„° ì†ì‹¤ ê°ì§€! ë°±ì—… ë°ì´í„°ë¡œ ë³µì›');
                    localStorage.setItem('employees', JSON.stringify(finalDataBackup));
                }
                
                // ì¦‰ì‹œ ì§ì› ëª©ë¡ ì—…ë°ì´íŠ¸
                console.log('ğŸ”„ ì§ì› ëª©ë¡ ë Œë”ë§ ì‹œì‘');
                renderEmployeeList();
                
                // 500ms í›„ ë‹¤ì‹œ ë Œë”ë§ (ì•ˆì •ì„± í–¥ìƒ)
                setTimeout(() => {
                    console.log('ğŸ”„ ë°ì´í„° ì €ì¥ í›„ ì§ì› ëª©ë¡ ì¬ë Œë”ë§');
                    
                    // ë Œë”ë§ ì „ ë°ì´í„° ë‹¤ì‹œ í™•ì¸
                    const preRenderData = JSON.parse(localStorage.getItem('employees') || '[]');
                    console.log('ğŸ” ì¬ë Œë”ë§ ì „ ë°ì´í„°:', preRenderData.length + 'ëª…');
                    
                    if (preRenderData.length < finalDataBackup.length) {
                        console.log('âš ï¸ ì¬ë Œë”ë§ ì „ ë°ì´í„° ì†ì‹¤ ê°ì§€! ë‹¤ì‹œ ë³µì›');
                        localStorage.setItem('employees', JSON.stringify(finalDataBackup));
                    }
                    
                    renderEmployeeList();
                }, 500);
            }, 100);
            
            // localStorageì— ë°ì´í„° ìœ ì§€ë¥¼ ìœ„í•œ ì¶”ê°€ ì €ì¥ (ì¤‘ë³µ ì €ì¥ìœ¼ë¡œ ì•ˆì •ì„± í–¥ìƒ)
            try {
                const verifyDataSave = JSON.parse(localStorage.getItem('employees') || '[]');
                const backupKey = `employees_backup_${Date.now()}`;
                localStorage.setItem(backupKey, JSON.stringify(verifyDataSave));
                console.log('ğŸ’¾ ë°±ì—… ë°ì´í„° ì €ì¥:', backupKey);
                
                // ì˜¤ë˜ëœ ë°±ì—… ì œê±° (5ê°œë§Œ ìœ ì§€)
                const allKeys = Object.keys(localStorage);
                const backupKeys = allKeys.filter(key => key.startsWith('employees_backup_')).sort();
                if (backupKeys.length > 5) {
                    const keysToRemove = backupKeys.slice(0, backupKeys.length - 5);
                    keysToRemove.forEach(key => localStorage.removeItem(key));
                    console.log('ğŸ—‘ï¸ ì˜¤ë˜ëœ ë°±ì—… ì œê±°:', keysToRemove.length + 'ê°œ');
                }
            } catch (backupError) {
                console.error('âš ï¸ ë°±ì—… ì €ì¥ ì˜¤ë¥˜:', backupError);
            }
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeEmployeeModal();
            
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ (currentEditingEmployee ë¦¬ì…‹ ì „ì— ì²´í¬)
            const isEditMode = currentEditingEmployee !== null;
            const message = isEditMode ? 'âœ… ì§ì› ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'âœ… ì§ì›ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.';
            console.log('ğŸ¯ í¸ì§‘ ëª¨ë“œ í™•ì¸:', isEditMode, 'currentEditingEmployee:', currentEditingEmployee);
            alert(message);
            
            // currentEditingEmployee ë¦¬ì…‹ (ì €ì¥ ì™„ë£Œ í›„)
            currentEditingEmployee = null;
            console.log('ğŸ”„ currentEditingEmployee ë¦¬ì…‹ ì™„ë£Œ');
            
            console.log('âœ… saveEmployee í•¨ìˆ˜ ì™„ë£Œ');
            
            // ì €ì¥ ì™„ë£Œ í›„ í”Œë˜ê·¸ í•´ì œ
            isSaving = false;
            console.log('ğŸ”“ ì €ì¥ í”Œë˜ê·¸ í•´ì œë¨');
            
            // ì €ì¥ í›„ 3ì´ˆ ë’¤ì— ë‹¤ì‹œ í•œë²ˆ í™•ì¸
            setTimeout(() => {
                console.log('ğŸ” 3ì´ˆ í›„ localStorage ì¬í™•ì¸:');
                const recheck = localStorage.getItem('employees');
                if (recheck) {
                    const parsed = JSON.parse(recheck);
                    console.log('  ğŸ“ employees:', parsed.length + 'ëª…');
                } else {
                    console.error('  âŒ employees ë°ì´í„°ê°€ ì‚¬ë¼ì§!');
                }
                
                if (companyId) {
                    const companyKey = `company_${companyId}_employees`;
                    const recheckCompany = localStorage.getItem(companyKey);
                    if (recheckCompany) {
                        const parsed = JSON.parse(recheckCompany);
                        console.log(`  ğŸ“ ${companyKey}:`, parsed.length + 'ëª…');
                    } else {
                        console.error(`  âŒ ${companyKey} ë°ì´í„°ê°€ ì‚¬ë¼ì§!`);
                    }
                }
            }, 3000);
        }

        function editEmployee(employeeId) {
            console.log('ğŸ”§ğŸ”§ğŸ”§ editEmployee í•¨ìˆ˜ í˜¸ì¶œë¨! employeeId:', employeeId);
            
            try {
                // ì¦‰ì‹œ ëª¨ë‹¬ ì—´ê¸° í…ŒìŠ¤íŠ¸
                console.log('âš¡ ì¦‰ì‹œ ëª¨ë‹¬ ì—´ê¸° ì‹œë„');
                openEmployeeModal(employeeId);
                
            } catch (error) {
                console.error('âŒ editEmployee ì˜¤ë¥˜:', error);
                alert('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }
        }

        // ë°±ì—… ë‹¨ìˆœ í•¨ìˆ˜
        function simpleEditEmployee(employeeId) {
            console.log('ğŸ”¥ simpleEditEmployee í˜¸ì¶œë¨:', employeeId);
            // alert ì œê±° - ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ í‘œì‹œí•˜ì§€ ì•ŠìŒ
            
            // ì§ì ‘ openEmployeeModal í˜¸ì¶œ
            openEmployeeModal(employeeId);
        }

        function deleteEmployee(employeeId) {
            console.log('ğŸ—‘ï¸ deleteEmployee ì‹œì‘, ID:', employeeId);
            const currentUser = AuthManager.getCurrentUser();
            
            // í˜„ì¬ íšŒì‚¬ ID ê°€ì ¸ì˜¤ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company');
            
            // íšŒì‚¬ë³„ ì§ì› ëª©ë¡ê³¼ í†µí•© ëª©ë¡ ëª¨ë‘ ê°€ì ¸ì˜¤ê¸°
            let companyEmployees = [];
            if (companyId) {
                const companyKey = `company_${companyId}_employees`;
                companyEmployees = JSON.parse(localStorage.getItem(companyKey) || '[]');
                console.log(`ğŸ“ ì‚­ì œ ì „ ${companyKey}:`, companyEmployees.length + 'ëª…');
            }
            const allEmployees = JSON.parse(localStorage.getItem('employees') || '[]');
            console.log('ğŸ“ ì‚­ì œ ì „ employees:', allEmployees.length + 'ëª…');
            
            // ì‚­ì œí•  ì§ì› ì°¾ê¸°
            const employee = companyEmployees.find(emp => emp.id === employeeId) || 
                           allEmployees.find(emp => emp.id === employeeId);
            
            console.log('ğŸ‘¤ ì‚­ì œí•  ì§ì›:', employee);
            
            if (!employee) {
                console.log('âš ï¸ ì§ì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ, ì´ë¯¸ ì‚­ì œë¨');
                return;
            }
            
            // ê¶Œí•œ ì²´í¬
            if (!canManageEmployees(currentUser)) {
                alert('ì§ì› ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì‹œìŠ¤í…œ ì‚¬ìš©ìëŠ” ì‚­ì œ ë¶ˆê°€
            if (isSystemUser(employee.role)) {
                alert('ì‹œìŠ¤í…œ ì‚¬ìš©ì(ë§ˆìŠ¤í„°, íšŒì‚¬ëŒ€í‘œ)ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm(`ì •ë§ë¡œ ${employee.name} ì§ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            try {
                // íšŒì‚¬ë³„ ëª©ë¡ì—ì„œ ì‚­ì œ
                if (companyId) {
                    const filteredCompanyEmployees = companyEmployees.filter(emp => emp.id !== employeeId);
                    const companyKey = `company_${companyId}_employees`;
                    localStorage.setItem(companyKey, JSON.stringify(filteredCompanyEmployees));
                    console.log(`ğŸ—‘ï¸ ${companyKey}ì—ì„œ ì‚­ì œ ì™„ë£Œ:`, filteredCompanyEmployees.length + 'ëª… ë‚¨ìŒ');
                }
                
                // í†µí•© ëª©ë¡ì—ì„œ ì‚­ì œ
                const filteredAllEmployees = allEmployees.filter(emp => emp.id !== employeeId);
                localStorage.setItem('employees', JSON.stringify(filteredAllEmployees));
                console.log('ğŸ—‘ï¸ employeesì—ì„œ ì‚­ì œ ì™„ë£Œ:', filteredAllEmployees.length + 'ëª… ë‚¨ìŒ');
                
                // ì‚­ì œ í›„ ë°±ì—… ìƒì„±
                createDataBackup(filteredAllEmployees);
                
                // ì¦‰ì‹œ í™•ì¸
                const verifyData = localStorage.getItem('employees');
                if (verifyData) {
                    const parsed = JSON.parse(verifyData);
                    console.log('âœ… ì‚­ì œ í›„ í™•ì¸:', parsed.length + 'ëª…');
                } else {
                    console.error('âŒ ì‚­ì œ í›„ ë°ì´í„° ì—†ìŒ!');
                }
                
                renderEmployeeList();
                
                // ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œì— ì§ì› ìˆ˜ ë™ê¸°í™”
                if (typeof window.syncEmployeeCount === 'function') {
                    window.syncEmployeeCount(companyId);
                    console.log('ğŸ”„ ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œì— ì§ì› ìˆ˜ ë™ê¸°í™”');
                }
                
                alert('ì§ì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                console.error('âŒ ì§ì› ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', error);
                alert('ì§ì› ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }









        function backToDashboard() {
            // íˆìŠ¤í† ë¦¬ì— ìƒíƒœ ì¶”ê°€ (í•´ì‹œ ë³€ê²½ ì—†ì´)
            history.pushState({ section: 'dashboard' }, 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ', window.location.pathname);
            
            // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
            showSection('dashboard');
        }

        // ì„¹ì…˜ í‘œì‹œ í†µí•© í•¨ìˆ˜
        function showSection(sectionName) {
            console.log('ğŸ¯ ì„¹ì…˜ ì „í™˜:', sectionName);
            
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            if (sectionName === 'dashboard' || !sectionName) {
                // ë©”ì¸ ëŒ€ì‹œë³´ë“œ í‘œì‹œ
                document.querySelector('.management-container').style.display = 'flex';
            } else {
                // ë©”ì¸ ëŒ€ì‹œë³´ë“œ ìˆ¨ê¸°ê¸°
                document.querySelector('.management-container').style.display = 'none';
                
                // ìš”ì²­ëœ ì„¹ì…˜ í‘œì‹œ
                const targetSection = document.getElementById(sectionName);
                if (targetSection) {
                    targetSection.style.display = 'block';
                    
                    // ì§ì› ê´€ë¦¬ ì„¹ì…˜ì¸ ê²½ìš° ë°ì´í„° ë¡œë“œ
                    if (sectionName === 'employees') {
                        renderEmployeeList();
                    }
                    // íšŒì‚¬ì •ë³´ ì„¹ì…˜ì¸ ê²½ìš° ë°ì´í„° ë¡œë“œ
                    else if (sectionName === 'companyInfo') {
                        loadCompanyInfo();
                    }
                } else {
                    console.warn('ì„¹ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', sectionName);
                    // ê¸°ë³¸ì ìœ¼ë¡œ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                    document.querySelector('.management-container').style.display = 'flex';
                }
            }
        }

        // URL í•´ì‹œ ë³€ê²½ ì²˜ë¦¬
        function handleHashChange() {
            const hash = window.location.hash.substring(1); // # ì œê±°
            console.log('ğŸ”— í•´ì‹œ ë³€ê²½:', hash);
            
            if (hash === 'employees') {
                // ê¶Œí•œ ì²´í¬
                const user = AuthManager.getCurrentUser();
                if (!user || !canManageEmployees(user)) {
                    alert('ì§ì› ê´€ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë§ˆìŠ¤í„°, íšŒì‚¬ëŒ€í‘œ, ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    window.location.hash = '';
                    return;
                }
                showSection('employees');
            } else {
                showSection('dashboard');
            }
        }

        // ì§ì› ì„¤ì • ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function openEmployeeSettingsModal() {
            console.log('âš™ï¸ ì§ì› ì„¤ì • ëª¨ë‹¬ ì—´ê¸°');
            const modal = document.getElementById('employeeSettingsModal');
            if (modal) {
                modal.style.display = 'flex';
                loadDepartmentsAndPositions();
            } else {
                console.error('âŒ ì„¤ì • ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        function closeEmployeeSettingsModal() {
            const modal = document.getElementById('employeeSettingsModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function loadDepartmentsAndPositions() {
            const departments = getDepartments();
            const positions = getPositions();
            
            renderDepartmentsList(departments);
            renderPositionsList(positions);
        }

        function getDepartments() {
            const saved = localStorage.getItem('employee_departments');
            return saved ? JSON.parse(saved) : ['ì˜ì—…ë¶€', 'ê´€ë¦¬ë¶€', 'ë¬¼ë¥˜ë¶€'];
        }

        function getPositions() {
            const saved = localStorage.getItem('employee_positions');
            return saved ? JSON.parse(saved) : ['ì´ì‚¬', 'ë¶€ì¥', 'ì°¨ì¥', 'ê³¼ì¥', 'ëŒ€ë¦¬', 'ê³„ì¥'];
        }

        function saveDepartments(departments) {
            localStorage.setItem('employee_departments', JSON.stringify(departments));
            updateEmployeeFormOptions();
        }

        function savePositions(positions) {
            localStorage.setItem('employee_positions', JSON.stringify(positions));
            updateEmployeeFormOptions();
        }

        function renderDepartmentsList(departments) {
            const container = document.getElementById('departmentsList');
            if (!container) return;
            
            container.innerHTML = departments.map((dept, index) => `
                <div style="display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.1); padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="color: #e2e8f0;">${dept}</span>
                    <button class="btn btn-danger btn-small" onclick="removeDepartment('${dept}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        function renderPositionsList(positions) {
            const container = document.getElementById('positionsList');
            if (!container) return;
            
            container.innerHTML = positions.map((pos, index) => `
                <div style="display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.1); padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="color: #e2e8f0;">${pos}</span>
                    <button class="btn btn-danger btn-small" onclick="removePosition('${pos}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        function addDepartment() {
            const input = document.getElementById('newDepartmentInput');
            const newDept = input.value.trim();
            
            if (!newDept) {
                alert('ë¶€ì„œëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const departments = getDepartments();
            if (departments.includes(newDept)) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¶€ì„œì…ë‹ˆë‹¤.');
                return;
            }
            
            departments.push(newDept);
            saveDepartments(departments);
            renderDepartmentsList(departments);
            input.value = '';
            
            alert('ìƒˆ ë¶€ì„œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function addPosition() {
            const input = document.getElementById('newPositionInput');
            const newPos = input.value.trim();
            
            if (!newPos) {
                alert('ì§ì±…ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const positions = getPositions();
            if (positions.includes(newPos)) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì§ì±…ì…ë‹ˆë‹¤.');
                return;
            }
            
            positions.push(newPos);
            savePositions(positions);
            renderPositionsList(positions);
            input.value = '';
            
            alert('ìƒˆ ì§ì±…ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function removeDepartment(deptToRemove) {
            // í•´ë‹¹ ë¶€ì„œë¥¼ ì‚¬ìš©í•˜ëŠ” ì§ì›ì´ ìˆëŠ”ì§€ í™•ì¸
            const employees = JSON.parse(localStorage.getItem('employees') || '[]');
            const employeesUsingDept = employees.filter(emp => emp.department === deptToRemove);
            
            if (employeesUsingDept.length > 0) {
                alert(`'${deptToRemove}' ë¶€ì„œë¥¼ ì‚¬ìš©í•˜ëŠ” ì§ì›ì´ ${employeesUsingDept.length}ëª… ìˆìŠµë‹ˆë‹¤. ë¨¼ì € í•´ë‹¹ ì§ì›ë“¤ì˜ ë¶€ì„œë¥¼ ë³€ê²½í•´ì£¼ì„¸ìš”.`);
                return;
            }
            
            if (!confirm(`'${deptToRemove}' ë¶€ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            const departments = getDepartments().filter(dept => dept !== deptToRemove);
            saveDepartments(departments);
            renderDepartmentsList(departments);
            
            alert('ë¶€ì„œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function removePosition(posToRemove) {
            // í•´ë‹¹ ì§ì±…ì„ ì‚¬ìš©í•˜ëŠ” ì§ì›ì´ ìˆëŠ”ì§€ í™•ì¸
            const employees = JSON.parse(localStorage.getItem('employees') || '[]');
            const employeesUsingPos = employees.filter(emp => emp.position === posToRemove);
            
            if (employeesUsingPos.length > 0) {
                alert(`'${posToRemove}' ì§ì±…ì„ ì‚¬ìš©í•˜ëŠ” ì§ì›ì´ ${employeesUsingPos.length}ëª… ìˆìŠµë‹ˆë‹¤. ë¨¼ì € í•´ë‹¹ ì§ì›ë“¤ì˜ ì§ì±…ì„ ë³€ê²½í•´ì£¼ì„¸ìš”.`);
                return;
            }
            
            if (!confirm(`'${posToRemove}' ì§ì±…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            const positions = getPositions().filter(pos => pos !== posToRemove);
            savePositions(positions);
            renderPositionsList(positions);
            
            alert('ì§ì±…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function updateEmployeeFormOptions() {
            // ì§ì› ëª¨ë‹¬ì˜ ë¶€ì„œ ë° ì§ì±… ì˜µì…˜ ì—…ë°ì´íŠ¸
            const departments = getDepartments();
            const positions = getPositions();
            
            const deptSelect = document.getElementById('employeeDepartment');
            const posSelect = document.getElementById('employeePosition');
            
            if (deptSelect) {
                const currentValue = deptSelect.value;
                let deptOptions = '<option value="">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                departments.forEach(dept => {
                    deptOptions += `<option value="${dept}">${dept}</option>`;
                });
                deptSelect.innerHTML = deptOptions;
                deptSelect.value = currentValue; // ê¸°ì¡´ ì„ íƒê°’ ë³µì›
            }
            
            if (posSelect) {
                const currentValue = posSelect.value;
                let posOptions = '<option value="">ì§ì±…ì„ ì„ íƒí•˜ì„¸ìš”</option>';
                positions.forEach(pos => {
                    posOptions += `<option value="${pos}">${pos}</option>`;
                });
                posSelect.innerHTML = posOptions;
                posSelect.value = currentValue; // ê¸°ì¡´ ì„ íƒê°’ ë³µì›
            }
        }

        // ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
        function goToMasterDashboard() {
            // í˜„ì¬ ì‚¬ìš©ì í™•ì¸
            const currentUser = AuthManager.getCurrentUser();
            
            if (currentUser.role === 'master') {
                window.location.href = 'master-dashboard.html';
            } else {
                alert('ë§ˆìŠ¤í„° ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
            }
        }
        
        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                AuthManager.logout();
                window.location.href = 'index.html';
            }
        }

        




        

        // ë¬¸ì„œ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        async function showDocumentManagement() {
            console.log('ğŸ“„ ë¬¸ì„œ ê´€ë¦¬ í‘œì‹œ');
            
            // ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ëŒ€ê¸°
            if (!window.db || !window.db.client) {
                console.log('ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì¤‘...');
                for (let i = 0; i < 50; i++) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    if (window.db && window.db.client) {
                        break;
                    }
                }
                if (!window.db || !window.db.client) {
                    alert('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return;
                }
            }
            
            showSection('documents');
            await loadDocumentTemplates();
        }
        window.showDocumentManagement = showDocumentManagement;

        let currentEditingTemplate = null;
        let documentTemplates = {
            career: {
                name: 'ê²½ë ¥ì¦ëª…ì„œ',
                icon: 'fas fa-certificate',
                enabled: true,
                content: `ê²½ë ¥ì¦ëª…ì„œ

ì„±ëª…: [ì´ë¦„]
ìƒë…„ì›”ì¼: [ìƒë…„ì›”ì¼]
ì£¼ì†Œ: [ì£¼ì†Œ]

ìœ„ ì‚¬ëŒì˜ ê²½ë ¥ì‚¬í•­ì„ ë‹¤ìŒê³¼ ê°™ì´ ì¦ëª…í•©ë‹ˆë‹¤.

ê·¼ë¬´ê¸°ê°„: [ì‹œì‘ì¼] ~ [ì¢…ë£Œì¼]
ê·¼ë¬´ë¶€ì„œ: [ë¶€ì„œëª…]
ë‹´ë‹¹ì—…ë¬´: [ì—…ë¬´ë‚´ìš©]
ì§ì±…: [ì§ì±…]

[ë°œê¸‰ì¼ì]
[íšŒì‚¬ëª…]
ëŒ€í‘œì´ì‚¬: [ëŒ€í‘œëª…] (ì§ì¸)`
            },
            employment: {
                name: 'ì¬ì§ì¦ëª…ì„œ',
                icon: 'fas fa-id-card',
                enabled: true,
                content: `ì¬ì§ì¦ëª…ì„œ

ì„±ëª…: [ì´ë¦„]
ìƒë…„ì›”ì¼: [ìƒë…„ì›”ì¼]
ì£¼ì†Œ: [ì£¼ì†Œ]

ìœ„ ì‚¬ëŒì€ ë³¸ íšŒì‚¬ì— ì¬ì§ì¤‘ì„ì„ ì¦ëª…í•©ë‹ˆë‹¤.

ì…ì‚¬ì¼: [ì…ì‚¬ì¼]
í˜„ ì§ì±…: [ì§ì±…]
í˜„ ë¶€ì„œ: [ë¶€ì„œ]
ì›” ê¸‰ì—¬: [ê¸‰ì—¬]ì›

ìš©ë„: [ì‚¬ìš©ìš©ë„]

[ë°œê¸‰ì¼ì]
[íšŒì‚¬ëª…]
ëŒ€í‘œì´ì‚¬: [ëŒ€í‘œëª…] (ì§ì¸)`
            },
            leave: {
                name: 'ì—°ì°¨ì‹ ì²­ì„œ',
                icon: 'fas fa-calendar-alt',
                enabled: true,
                content: `ì—°ì°¨ ì‹ ì²­ì„œ

ì‹ ì²­ì: [ì´ë¦„]
ë¶€ì„œ: [ë¶€ì„œ]
ì§ì±…: [ì§ì±…]

ì—°ì°¨ ì‚¬ìš© ë‚´ì—­:
- ì‚¬ìš©ì¼ì: [ì‹œì‘ì¼] ~ [ì¢…ë£Œì¼]
- ì‚¬ìš©ì¼ìˆ˜: [ì¼ìˆ˜]ì¼
- ì‚¬ìœ : [ì‚¬ìœ ]

ê¸´ê¸‰ì—°ë½ì²˜: [ì—°ë½ì²˜]

ìœ„ì™€ ê°™ì´ ì—°ì°¨ì‚¬ìš©ì„ ì‹ ì²­í•©ë‹ˆë‹¤.

ì‹ ì²­ì¼: [ë‚ ì§œ]
ì‹ ì²­ì: [ì´ë¦„] (ì„œëª…)

ìŠ¹ì¸ì¼: [ë‚ ì§œ]
ìŠ¹ì¸ì: [ìŠ¹ì¸ì] (ì„œëª…)`
            },
            resignation: {
                name: 'ì‚¬ì§ì„œ',
                icon: 'fas fa-sign-out-alt',
                enabled: true,
                content: `ì‚¬ì§ì„œ

ì„±ëª…: [ì´ë¦„]
ì…ì‚¬ì¼: [ì…ì‚¬ì¼]
ë¶€ì„œ: [ë¶€ì„œ]
ì§ì±…: [ì§ì±…]

ë³¸ì¸ì€ ê°œì¸ì ì¸ ì‚¬ì •ìœ¼ë¡œ ì¸í•˜ì—¬ ì‚¬ì§í•˜ê³ ì í•˜ë‹ˆ 
ìŠ¹ì¸í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

ì‚¬ì§ ì˜ˆì •ì¼: [ì‚¬ì§ì¼]
ì‚¬ì§ ì‚¬ìœ : [ì‚¬ìœ ]

[ì‘ì„±ì¼ì]
[ì´ë¦„] (ì„œëª…)

[íšŒì‚¬ëª…] ê·€ì¤‘`
            },
            incident: {
                name: 'ê²½ìœ„ì„œ',
                icon: 'fas fa-exclamation-triangle',
                enabled: true,
                content: `ê²½ìœ„ì„œ

ì œëª©: [ì œëª©]
ì‘ì„±ì: [ì´ë¦„]
ë¶€ì„œ: [ë¶€ì„œ]
ì‘ì„±ì¼: [ë‚ ì§œ]

ì‚¬ê±´ ê°œìš”:
[ì‚¬ê±´ ê°œìš” ì‘ì„±]

ìƒì„¸ ê²½ìœ„:
[ìƒì„¸ ê²½ìœ„ ì‘ì„±]

ì›ì¸ ë¶„ì„:
[ì›ì¸ ë¶„ì„ ì‘ì„±]

ê°œì„  ë°©ì•ˆ:
[ê°œì„  ë°©ì•ˆ ì‘ì„±]

[ì‘ì„±ì¼ì]
ì‘ì„±ì: [ì´ë¦„] (ì„œëª…)`
            },
            businessTrip: {
                name: 'ì¶œì¥ ë³´ê³ ì„œ',
                icon: 'fas fa-plane',
                enabled: true,
                content: `ì¶œì¥ ë³´ê³ ì„œ

ì¶œì¥ì: [ì´ë¦„]
ë¶€ì„œ: [ë¶€ì„œ]
ì¶œì¥ê¸°ê°„: [ì‹œì‘ì¼] ~ [ì¢…ë£Œì¼]
ì¶œì¥ì§€: [ì¶œì¥ì§€]
ì¶œì¥ëª©ì : [ëª©ì ]

ì¶œì¥ ë‚´ìš©:
[ì¶œì¥ ë‚´ìš© ì‘ì„±]

ì„±ê³¼ ë° ê²°ê³¼:
[ì„±ê³¼ ë° ê²°ê³¼ ì‘ì„±]

íŠ¹ì´ì‚¬í•­:
[íŠ¹ì´ì‚¬í•­ ì‘ì„±]

í–¥í›„ ê³„íš:
[í–¥í›„ ê³„íš ì‘ì„±]

[ì‘ì„±ì¼ì]
ì¶œì¥ì: [ì´ë¦„] (ì„œëª…)`
            },
            proposal: {
                name: 'ê¸°ì•ˆì„œ',
                icon: 'fas fa-file-signature',
                enabled: true,
                content: `ê¸°ì•ˆì„œ

ì œëª©: [ì œëª©]
ê¸°ì•ˆì: [ì´ë¦„]
ë¶€ì„œ: [ë¶€ì„œ]
ê¸°ì•ˆì¼: [ë‚ ì§œ]

1. ê¸°ì•ˆ ë°°ê²½
[ê¸°ì•ˆ ë°°ê²½ ì‘ì„±]

2. ê¸°ì•ˆ ë‚´ìš©
[ê¸°ì•ˆ ë‚´ìš© ì‘ì„±]

3. ê¸°ëŒ€ íš¨ê³¼
[ê¸°ëŒ€ íš¨ê³¼ ì‘ì„±]

4. ì˜ˆì‚° ë° ì¼ì •
[ì˜ˆì‚° ë° ì¼ì • ì‘ì„±]

[ê¸°ì•ˆì¼ì]
ê¸°ì•ˆì: [ì´ë¦„] (ì„œëª…)

ê²°ì¬ë€:
ë‹´ë‹¹: _______ íŒ€ì¥: _______ ë³¸ë¶€ì¥: _______`
            }
        };

        // í…œí”Œë¦¿ ë¡œë“œ
        async function loadDocumentTemplates() {
            try {
                // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í…œí”Œë¦¿ ì„¤ì • ë° ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œë“œ
                const dbSettings = await loadDocumentTemplateSettings();
                const saved = localStorage.getItem('documentTemplates');
                
                if (saved) {
                    const savedTemplates = JSON.parse(saved);
                    // ê¸°ì¡´ ì €ì¥ëœ í…œí”Œë¦¿ê³¼ ê¸°ë³¸ í…œí”Œë¦¿ì„ ë³‘í•©
                    Object.keys(documentTemplates).forEach(templateId => {
                        if (savedTemplates[templateId]) {
                            // enabled ì†ì„±ì´ ì—†ëŠ” ê²½ìš° trueë¡œ ì„¤ì •
                            if (savedTemplates[templateId].enabled === undefined) {
                                savedTemplates[templateId].enabled = true;
                            }
                            documentTemplates[templateId] = savedTemplates[templateId];
                        }
                    });
                    // ìƒˆë¡œ ì¶”ê°€ëœ ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿ë“¤ë„ í¬í•¨
                    Object.keys(savedTemplates).forEach(templateId => {
                        if (!documentTemplates[templateId]) {
                            documentTemplates[templateId] = savedTemplates[templateId];
                        }
                    });
                }
                
                // ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                dbSettings.forEach(setting => {
                    if (documentTemplates[setting.template_id]) {
                        documentTemplates[setting.template_id].enabled = setting.is_enabled;
                    }
                });
                
                await renderTemplates();
            } catch (error) {
                console.error('í…œí”Œë¦¿ ë¡œë“œ ì˜¤ë¥˜:', error);
                // ì—ëŸ¬ ë°œìƒ ì‹œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë§Œ ì‚¬ìš©
                const saved = localStorage.getItem('documentTemplates');
                if (saved) {
                    const savedTemplates = JSON.parse(saved);
                    Object.keys(documentTemplates).forEach(templateId => {
                        if (savedTemplates[templateId]) {
                            documentTemplates[templateId] = savedTemplates[templateId];
                        }
                    });
                }
                await renderTemplates();
            }
        }

        // í…œí”Œë¦¿ ì €ì¥
        async function saveDocumentTemplates() {
            // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ë„ ì €ì¥ (í˜¸í™˜ì„±ì„ ìœ„í•´)
            localStorage.setItem('documentTemplates', JSON.stringify(documentTemplates));
            
            // ë°ì´í„°ë² ì´ìŠ¤ì—ë„ ì €ì¥
            try {
                if (window.db) {
                    for (const [templateId, template] of Object.entries(documentTemplates)) {
                        await window.db.updateDocumentTemplateSettings(templateId, {
                            template_name: template.name,
                            is_enabled: template.enabled,
                            company_domain: 'namkyungsteel.com'
                        });
                    }
                }
            } catch (error) {
                console.error('ë°ì´í„°ë² ì´ìŠ¤ í…œí”Œë¦¿ ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }

        // í…œí”Œë¦¿ í† ê¸€
        async function toggleTemplate(templateId) {
            if (documentTemplates[templateId]) {
                documentTemplates[templateId].enabled = !documentTemplates[templateId].enabled;
                await saveDocumentTemplates();
                
                // ë°ì´í„°ë² ì´ìŠ¤ì—ë„ ì—…ë°ì´íŠ¸
                try {
                    if (window.db) {
                        await window.db.updateDocumentTemplateSettings(templateId, {
                            is_enabled: documentTemplates[templateId].enabled,
                            company_domain: 'namkyungsteel.com'
                        });
                    }
                } catch (error) {
                    console.error('í…œí”Œë¦¿ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                }
                
                await renderTemplates();
                
                const status = documentTemplates[templateId].enabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”';
                console.log(`ğŸ“„ ${documentTemplates[templateId].name} ${status}`);
            }
        }

        // ìƒˆ í…œí”Œë¦¿ ì¶”ê°€
        async function addNewTemplate() {
            const name = prompt('ìƒˆ í…œí”Œë¦¿ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (name && name.trim()) {
                const id = 'template_' + Date.now();
                documentTemplates[id] = {
                    name: name.trim(),
                    icon: 'fas fa-file-alt',
                    enabled: true,
                    content: 'ìƒˆë¡œìš´ í…œí”Œë¦¿ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.'
                };
                await saveDocumentTemplates();
                await renderTemplates();
            }
        }

        // í…œí”Œë¦¿ í¸ì§‘
        function editTemplate(templateId) {
            const template = documentTemplates[templateId];
            if (!template) return;

            currentEditingTemplate = templateId;
            document.getElementById('templateEditName').value = template.name;
            document.getElementById('templateEditContent').value = template.content;
            document.getElementById('templateEditModal').style.display = 'flex';
        }

        // í…œí”Œë¦¿ í¸ì§‘ ì €ì¥
        async function saveTemplateEdit() {
            if (!currentEditingTemplate) return;

            const name = document.getElementById('templateEditName').value.trim();
            const content = document.getElementById('templateEditContent').value.trim();

            if (name && content) {
                documentTemplates[currentEditingTemplate].name = name;
                documentTemplates[currentEditingTemplate].content = content;
                await saveDocumentTemplates();
                await renderTemplates();
                closeTemplateEdit();
                alert('í…œí”Œë¦¿ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                alert('í…œí”Œë¦¿ ì´ë¦„ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // í…œí”Œë¦¿ í¸ì§‘ ë‹«ê¸°
        function closeTemplateEdit() {
            document.getElementById('templateEditModal').style.display = 'none';
            currentEditingTemplate = null;
        }

        // í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° (admin ì „ìš©)
        function previewAdminTemplate(templateId) {
            console.log('ğŸ” previewAdminTemplate í˜¸ì¶œë¨, templateId:', templateId);
            console.log('ğŸ“‹ í˜„ì¬ documentTemplates:', documentTemplates);
            console.log('ğŸ“‹ documentTemplates í‚¤ë“¤:', Object.keys(documentTemplates));
            
            // ë¨¼ì € í…œí”Œë¦¿ì´ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (!documentTemplates || Object.keys(documentTemplates).length === 0) {
                console.log('ğŸ“„ í…œí”Œë¦¿ì„ ë‹¤ì‹œ ë¡œë“œí•©ë‹ˆë‹¤...');
                loadDocumentTemplates();
            }
            
            const template = documentTemplates[templateId];
            if (!template) {
                console.error('âŒ í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', templateId);
                console.log('ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ í…œí”Œë¦¿ë“¤:', Object.keys(documentTemplates));
                alert('í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            console.log('âœ… ë¯¸ë¦¬ë³´ê¸° ì—´ê¸°:', template.name);
            
            const previewContent = document.getElementById('previewContent');
            const modal = document.getElementById('templatePreviewModal');
            
            if (!previewContent || !modal) {
                console.error('âŒ ë¯¸ë¦¬ë³´ê¸° ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                alert('ë¯¸ë¦¬ë³´ê¸° ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            previewContent.textContent = template.content;
            modal.style.display = 'block';
        }

        // ê¸°ì¡´ previewTemplate í•¨ìˆ˜ ì˜¤ë²„ë¼ì´ë“œ
        function previewTemplate(templateId) {
            return previewAdminTemplate(templateId);
        }

        // í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸°
        function closeTemplatePreview() {
            const modal = document.getElementById('templatePreviewModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // í…œí”Œë¦¿ ì¸ì‡„
        function printTemplate() {
            window.print();
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('templatePreviewModal');
            if (modal && event.target === modal) {
                closeTemplatePreview();
            }
        });

        // í…œí”Œë¦¿ ì‚­ì œ
        async function deleteTemplate(templateId) {
            if (templateId === 'career') {
                alert('ê¸°ë³¸ ê²½ë ¥ì¦ëª…ì„œ í…œí”Œë¦¿ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const template = documentTemplates[templateId];
            if (confirm(`"${template.name}" í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                delete documentTemplates[templateId];
                await saveDocumentTemplates();
                await renderTemplates();
            }
        }

        // í…œí”Œë¦¿ ë Œë”ë§
        async function renderTemplates() {
            const container = document.getElementById('documentTemplates');
            container.innerHTML = '';

            // ìµœì¢… ìŠ¹ì¸ì ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const approvers = await loadApprovers();
            
            // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í…œí”Œë¦¿ ì„¤ì • ê°€ì ¸ì˜¤ê¸°
            const templateSettings = await loadDocumentTemplateSettings();

            Object.keys(documentTemplates).forEach(templateId => {
                const template = documentTemplates[templateId];
                const templateSetting = templateSettings.find(t => t.template_id === templateId);
                const finalApproverId = templateSetting?.final_approver_id || '';
                
                const templateCard = document.createElement('div');
                templateCard.className = 'template-card';
                templateCard.setAttribute('data-template', templateId);

                templateCard.innerHTML = `
                    <div class="template-header">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="${template.icon}" style="color: #10b981;"></i>
                            <h4 style="color: #ffffff; margin: 0;">${template.name}</h4>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span style="color: #e5e7eb; font-size: 0.9rem;">ê²°ì¬ì„œë¥˜ í‘œì‹œ</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${template.enabled ? 'checked' : ''} onchange="toggleTemplate('${templateId}')">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: #e5e7eb; font-size: 0.9rem;">ìµœì¢… ìŠ¹ì¸ì</span>
                                    <select id="finalApprover_${templateId}" style="padding: 0.5rem; border-radius: 4px; border: 1px solid #ccc; background: white; color: #333;" onchange="updateFinalApprover('${templateId}', this.value)">
                                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                        ${approvers.map(approver => `<option value="${approver.id}" ${approver.id == finalApproverId ? 'selected' : ''}>${approver.name} (${approver.position})</option>`).join('')}
                                    </select>
                                </div>
                                <div class="template-actions">
                                    <button class="btn btn-small btn-danger" onclick="deleteTemplate('${templateId}')" style="padding: 0.5rem 0.75rem;">
                                        <i class="fas fa-trash"></i> ì‚­ì œ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                container.appendChild(templateCard);
            });
        }

        // í™œì„±í™”ëœ í…œí”Œë¦¿ ê°€ì ¸ì˜¤ê¸° (ê²°ì¬ ì„œë¥˜ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©)
        function getEnabledTemplates() {
            const enabled = {};
            Object.keys(documentTemplates).forEach(templateId => {
                if (documentTemplates[templateId].enabled) {
                    enabled[templateId] = documentTemplates[templateId];
                }
            });
            return enabled;
        }

        // ìµœì¢… ìŠ¹ì¸ì ëª©ë¡ ë¡œë“œ
        async function loadApprovers() {
            try {
                if (!window.db) {
                    console.error('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    return [];
                }
                
                // ê´€ë¦¬ì ë° ë§¤ë‹ˆì € ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìë“¤ ì¡°íšŒ
                const approvers = await window.db.getUsersByRole(['company_CEO', 'company_manager', 'company_admin']);
                return approvers;
            } catch (error) {
                console.error('ìŠ¹ì¸ì ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                return [];
            }
        }

        // ë¬¸ì„œ í…œí”Œë¦¿ ì„¤ì • ë¡œë“œ
        async function loadDocumentTemplateSettings() {
            try {
                if (!window.db) {
                    console.error('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    return [];
                }
                
                const settings = await window.db.getDocumentTemplatesSettings('namkyungsteel.com');
                return settings;
            } catch (error) {
                console.error('ë¬¸ì„œ í…œí”Œë¦¿ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', error);
                return [];
            }
        }

        // ìµœì¢… ìŠ¹ì¸ì ì—…ë°ì´íŠ¸
        async function updateFinalApprover(templateId, approverId) {
            try {
                if (!window.db) {
                    console.error('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    return;
                }
                
                const settings = {
                    final_approver_id: approverId ? parseInt(approverId) : null,
                    company_domain: 'namkyungsteel.com'
                };
                
                await window.db.updateDocumentTemplateSettings(templateId, settings);
                console.log(`ğŸ“„ ${templateId} ìµœì¢… ìŠ¹ì¸ì ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
                alert('ìµœì¢… ìŠ¹ì¸ìê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ìµœì¢… ìŠ¹ì¸ì ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                alert('ìµœì¢… ìŠ¹ì¸ì ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë¬¸ì„œ ì„¤ì • ì €ì¥ (ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€)
        function saveDocumentSettings() {
            console.log('ğŸ“„ ë¬¸ì„œ ì„¤ì • ì €ì¥');
            alert('í…œí”Œë¦¿ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        
        // ë¸Œë¼ìš°ì € ë’¤ë¡œê°€ê¸°/ì•ìœ¼ë¡œê°€ê¸° ì²˜ë¦¬
        async function handlePopState(event) {
            console.log('ğŸ”„ ë¸Œë¼ìš°ì € ë„¤ë¹„ê²Œì´ì…˜ ê°ì§€:', window.location.hash);
            const hash = window.location.hash.substring(1); // # ì œê±°
            
            if (!hash || hash === '') {
                // ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                showSection('dashboard');
            } else {
                // í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ì´ë™
                showSection(hash);
                
                // ê° ì„¹ì…˜ë³„ ë°ì´í„° ë¡œë“œ
                if (hash === 'employees') {
                    // ì§ì› ê´€ë¦¬ ì„¹ì…˜ì˜ ê²½ìš° ê¶Œí•œ ì²´í¬
                    const user = AuthManager.getCurrentUser();
                    if (user && canManageEmployees(user)) {
                        // ì´ë¯¸ showSectionì—ì„œ í™”ë©´ì„ í‘œì‹œí–ˆìœ¼ë¯€ë¡œ ì¶”ê°€ ë¡œì§ ì—†ìŒ
                    } else {
                        // ê¶Œí•œ ì—†ìœ¼ë©´ ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                        window.location.hash = '';
                        showSection('dashboard');
                        alert('ì§ì› ê´€ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } else if (hash === 'documents') {
                    // ë¬¸ì„œ ê´€ë¦¬ ì„¹ì…˜
                    await loadDocumentTemplates();
                }
            }
        }

        // í˜ì´ì§€ ì´ˆê¸°í™” ì‹œ URL í•´ì‹œ í™•ì¸
        function initializePage() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                // URLì— í•´ì‹œê°€ ìˆìœ¼ë©´ í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ì´ë™
                handlePopState();
            } else {
                // í•´ì‹œê°€ ì—†ìœ¼ë©´ ë©”ì¸ ëŒ€ì‹œë³´ë“œ í‘œì‹œ
                showSection('dashboard');
            }
            
            // ìš”ì²­ ì•Œë¦¼ ì²´í¬
            checkRequestNotifications();
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        window.addEventListener('popstate', handlePopState);
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', initializePage);

        // ì „ì—­ í•¨ìˆ˜ ë“±ë¡
        window.showDocumentManagement = showDocumentManagement;
        window.saveDocumentSettings = saveDocumentSettings;
        window.handlePopState = handlePopState;
        window.initializePage = initializePage;
        window.openCorporateCardManagement = openCorporateCardManagement;
        window.showCompanyInfoManagement = showCompanyInfoManagement;
        window.checkAdminNotifications = checkAdminNotifications;
        
        // ë¬¸ì„œ í…œí”Œë¦¿ ê´€ë ¨ ì „ì—­ í•¨ìˆ˜
        window.getEnabledTemplates = getEnabledTemplates;
        window.documentTemplates = documentTemplates;
        window.loadDocumentTemplates = loadDocumentTemplates;
        window.previewAdminTemplate = previewAdminTemplate;
        window.previewTemplate = previewTemplate;

        // ë²•ì¸ì¹´ë“œ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
        function openCorporateCardManagement() {
            window.location.href = 'corporate-card.html?admin=true';
        }
        window.openCorporateCardManagement = openCorporateCardManagement;


        // ê´€ë¦¬ì ì•Œë¦¼ ì²´í¬ í•¨ìˆ˜
        function checkAdminNotifications() {
            const notifications = JSON.parse(localStorage.getItem('corporateCardNotifications') || '[]');
            const unreadNotifications = notifications.filter(n => !n.read);
            
            const badge = document.getElementById('adminCardNotificationBadge');
            if (badge) {
                if (unreadNotifications.length > 0) {
                    badge.textContent = unreadNotifications.length;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        // íšŒì‚¬ì •ë³´ ê´€ë¦¬ í•¨ìˆ˜ë“¤
                const sealPreview = document.getElementById('companySealPreview');
                if (sealPreview) {
                    sealPreview.src = data.company_seal_url;
                    sealPreview.style.display = 'block';
                }
            }
        }
        
        // ìš”ì²­ ì•Œë¦¼ ì²´í¬ í•¨ìˆ˜
        async function checkRequestNotifications() {
            try {
                // Supabase ì„¤ì •
                const SUPABASE_URL = 'https://zgyawfmjconubxaiamod.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpneWF3Zm1qY29udWJ4YWlhbW9kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjQzNzIsImV4cCI6MjA2NzM0MDM3Mn0.shjBE2OQeILwkLLi4E6Bq0-b6YPUs-WFwquexdUiM9A';
                
                const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                
                // ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ ìˆ˜ ì¡°íšŒ
                const [quoteResult, catalogResult, technicalResult] = await Promise.all([
                    supabaseClient.from('quote_requests').select('id', { count: 'exact' }).eq('status', 'pending'),
                    supabaseClient.from('catalog_requests').select('id', { count: 'exact' }).eq('status', 'pending'),
                    supabaseClient.from('technical_support_requests').select('id', { count: 'exact' }).eq('status', 'pending')
                ]);
                
                const pendingQuotes = quoteResult.count || 0;
                const pendingCatalogs = catalogResult.count || 0;
                const pendingTechnical = technicalResult.count || 0;
                const totalPendingRequests = pendingQuotes + pendingCatalogs + pendingTechnical;
                
                console.log('ğŸ“‹ ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­:', {
                    ê²¬ì : pendingQuotes,
                    ì¹´íƒˆë¡œê·¸: pendingCatalogs,
                    ê¸°ìˆ ì§€ì›: pendingTechnical,
                    ì´í•©: totalPendingRequests
                });
                
                // ê²¬ì ìš”ì²­ ì¹´ë“œ ë°°ì§€ ì—…ë°ì´íŠ¸
                const requestBadge = document.getElementById('requestNotificationBadge');
                if (requestBadge) {
                    if (totalPendingRequests > 0) {
                        requestBadge.style.display = 'flex';
                        requestBadge.querySelector('span').textContent = totalPendingRequests;
                    } else {
                        requestBadge.style.display = 'none';
                    }
                }
                
                console.log('âœ… ìš”ì²­ ì•Œë¦¼ ì²´í¬ ì™„ë£Œ:', totalPendingRequests, 'ê±´');
                
            } catch (error) {
                console.error('âŒ ìš”ì²­ ì•Œë¦¼ ì²´í¬ ì˜¤ë¥˜:', error);
            }
        }
        
        // íšŒì‚¬ ì¸ê° ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleCompanySealUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            // íŒŒì¼ í¬ê¸° í™•ì¸ (2MB ì œí•œ)
            const maxSize = 2 * 1024 * 1024; // 2MB
            if (file.size > maxSize) {
                alert('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. 2MB ì´í•˜ì˜ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                input.value = '';
                return;
            }
            
            // íŒŒì¼ í˜•ì‹ í™•ì¸
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];
            if (!allowedTypes.includes(file.type)) {
                alert('JPG, PNG íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                input.value = '';
                return;
            }
            
            // ì´ë¯¸ì§€ë¥¼ Base64ë¡œ ë³€í™˜í•˜ì—¬ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('companySealPreview');
                const removeBtn = document.getElementById('companySealRemove');
                
                preview.src = e.target.result;
                preview.style.display = 'block';
                removeBtn.style.display = 'block';
                
                console.log('âœ… íšŒì‚¬ ì¸ê° ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ');
            };
            
            reader.onerror = function() {
                alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                input.value = '';
            };
            
            reader.readAsDataURL(file);
        }
        
        // íšŒì‚¬ ì¸ê° ì´ë¯¸ì§€ ì œê±°
        function removeCompanySeal() {
            const preview = document.getElementById('companySealPreview');
            const removeBtn = document.getElementById('companySealRemove');
            const uploadInput = document.getElementById('companySealUpload');
            
            preview.src = '';
            preview.style.display = 'none';
            removeBtn.style.display = 'none';
            uploadInput.value = '';
            
            console.log('ğŸ—‘ï¸ íšŒì‚¬ ì¸ê° ì´ë¯¸ì§€ ì œê±° ì™„ë£Œ');
        }



        // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        async function getCurrentUser() {
            try {
                const localUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!localUser) return null;
                
                if (window.db && window.db.client) {
                    const { data, error } = await window.db.client
                        .from('users')
                        .select('*')
                        .eq('email', localUser.email)
                        .eq('is_active', true)
                        .single();
                        
                    if (!error && data) {
                        return data;
                    }
                }
                
                return localUser;
            } catch (error) {
                console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                return null;
            }
        }

    </script>
    <script src="../../shared-assets/js/platform.js"></script>
</body>
</html>
