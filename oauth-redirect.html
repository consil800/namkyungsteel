<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬</title>
</head>
<body>
    <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
        <h2>ğŸ” ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘...</h2>
        <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
    </div>

    <script>
        // URLì—ì„œ í† í° ì •ë³´ ì¶”ì¶œ
        const urlParams = new URLSearchParams(window.location.search);
        const hashParams = new URLSearchParams(window.location.hash.substring(1));
        
        const accessToken = hashParams.get('access_token') || urlParams.get('access_token');
        const refreshToken = hashParams.get('refresh_token') || urlParams.get('refresh_token');
        
        if (accessToken) {
            console.log('âœ… OAuth í† í° ë°œê²¬, ì²˜ë¦¬ ì¤‘...');
            
            try {
                // JWT í† í° ë””ì½”ë”©
                const tokenParts = accessToken.split('.');
                const payload = JSON.parse(atob(tokenParts[1]));
                console.log('í† í° í˜ì´ë¡œë“œ:', payload);
                
                // ì‚¬ìš©ì ì •ë³´ ìƒì„±
                const user = {
                    id: payload.sub,
                    email: payload.email,
                    name: payload.user_metadata?.full_name || payload.user_metadata?.name || payload.email,
                    role: 'employee',
                    profileImage: payload.user_metadata?.avatar_url || payload.user_metadata?.picture,
                    provider: 'google',
                    company_domain: 'namkyungsteel.com',
                    company_name: 'ë‚¨ê²½ìŠ¤í‹¸(ì£¼)'
                };
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem('currentUser', JSON.stringify(user));
                localStorage.setItem('userRole', user.role);
                localStorage.setItem('userName', user.name);
                localStorage.setItem('accessToken', accessToken);
                if (refreshToken) {
                    localStorage.setItem('refreshToken', refreshToken);
                }
                
                console.log('âœ… Google ë¡œê·¸ì¸ ì™„ë£Œ:', user);
                
                // ë©”ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                window.location.href = 'https://namkyungsteel.com';
                
            } catch (error) {
                console.error('âŒ í† í° ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                window.location.href = 'https://namkyungsteel.com';
            }
        } else {
            console.log('âŒ í† í°ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            window.location.href = 'https://namkyungsteel.com';
        }
    </script>
</body>
</html>